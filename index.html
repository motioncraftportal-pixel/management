<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Motioncraft Owner Dashboard</title>
    
    <!-- DNS Prefetch -->
    <link rel="dns-prefetch" href="https://unpkg.com">
    <link rel="dns-prefetch" href="https://cdn.tailwindcss.com">
    <link rel="dns-prefetch" href="https://www.gstatic.com">
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
    
    <!-- Preconnect -->
    <link rel="preconnect" href="https://unpkg.com" crossorigin>
    <link rel="preconnect" href="https://cdn.tailwindcss.com" crossorigin>
    
    <!-- Critical CSS First -->
    <style>
        /* Inline critical CSS for instant render */
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, sans-serif; }
        #root { min-height: 100vh; background: #f9fafb; }
        
        /* Startup Loader Styles */
        #startup-loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: #f9fafb;
            z-index: 10000;
            transition: opacity 0.5s ease;
        }
        .loader-circle {
            width: 50px;
            height: 50px;
            border: 4px solid #e5e7eb;
            border-top: 4px solid #2563eb;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        .loader-text {
            margin-top: 15px;
            color: #374151;
            font-weight: 600;
            font-size: 1.2rem;
        }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    </style>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome - Async Load -->
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"></noscript>
    
    <!-- React Production Build -->
    <script crossorigin src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- PDF Libraries - Defer Load -->
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    
    <!-- Firebase - Defer Load -->
    <script defer src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics-compat.js"></script>
    
    <!-- Google Font - Async -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Gochi+Hand&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link href="https://fonts.googleapis.com/css2?family=Gochi+Hand&display=swap" rel="stylesheet"></noscript>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    screens: {
                        'xs': '375px',
                        'sm': '640px',
                        'md': '768px',
                        'lg': '1024px',
                        'xl': '1280px',
                        '2xl': '1536px',
                    }
                }
            }
        }
    </script>
    
    <style>
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            min-height: 100vh;
            overflow-x: hidden;
        }

        html {
            scroll-behavior: smooth;
        }

        #root {
            min-height: 100vh;
        }
        
        /* Status Colors */
        .status-fresh { background-color: #dbeafe; color: #1e40af; }
        .status-scripting { background-color: #fef3c7; color: #92400e; }
        .status-editing { background-color: #fce7f3; color: #be185d; }
        .status-correction { background-color: #fef3c7; color: #92400e; }
        .status-final-delivery { background-color: #dcfce7; color: #166534; }
        .status-completed { background-color: #f1f5f9; color: #475569; }
        
        /* Payment Colors */
        .payment-pending { background-color: #fef3c7; color: #92400e; }
        .payment-paid { background-color: #dcfce7; color: #166534; }
        .payment-partial { background-color: #fef3c7; color: #92400e; }
        
        /* Card Shadow */
        .shadow-card {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        /* Overdue Order */
        .overdue {
            background-color: #fef2f2;
            border-left: 4px solid #ef4444;
        }
        
                /* Fresh Order - No Animation, Just Static Style */
        .new-order {
            background-color: #eff6ff;
            border-left: 4px solid #3b82f6;
        }
        
        /* Sticky Notes */
        .sticky-note {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            transform: rotate(-1deg);
            min-height: 180px;
            position: relative;
        }
        
        .sticky-note:hover {
            transform: rotate(0deg) scale(1.02);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .sticky-note-yellow { background: linear-gradient(135deg, #fef9c3 0%, #fef08a 100%); }
        .sticky-note-blue { background: linear-gradient(135deg, #dbeafe 0%, #93c5fd 100%); }
        .sticky-note-green { background: linear-gradient(135deg, #dcfce7 0%, #86efac 100%); }
        .sticky-note-pink { background: linear-gradient(135deg, #fce7f3 0%, #f9a8d4 100%); }
        .sticky-note-purple { background: linear-gradient(135deg, #f3e8ff 0%, #d8b4fe 100%); }
        
        .pin {
            width: 16px;
            height: 16px;
            background: radial-gradient(circle at 30% 30%, #ef4444, #dc2626);
            border-radius: 50%;
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        @media (min-width: 768px) {
            .pin {
                width: 20px;
                height: 20px;
                top: -10px;
            }
        }
        
        .note-content {
            font-family: 'Gochi Hand', cursive;
            line-height: 1.4;
        }
        
        .category-tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
        }
        
        @media (min-width: 768px) {
            .category-tag {
                font-size: 0.75rem;
            }
        }
        
        /* Modal */
        .modal-content {
            max-height: 90vh;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        @media (min-width: 768px) {
            .modal-content {
                max-height: 85vh;
            }
        }
        
        /* Toast */
        .toast {
            position: fixed;
            bottom: 70px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 9999;
            animation: slideUp 0.3s ease;
            max-width: 90%;
            text-align: center;
            font-size: 0.875rem;
        }
        
        @media (min-width: 768px) {
            .toast {
                bottom: 20px;
                left: auto;
                right: 20px;
                transform: none;
                animation: slideIn 0.3s ease;
                max-width: 400px;
            }
        }
        
        .toast-success { background-color: #10b981; }
        .toast-error { background-color: #ef4444; }
        .toast-info { background-color: #3b82f6; }
        
        @keyframes slideUp {
            from { transform: translateX(-50%) translateY(100%); opacity: 0; }
            to { transform: translateX(-50%) translateY(0); opacity: 1; }
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Sync Indicator */
        .sync-indicator {
            display: inline-flex;
            align-items: center;
            padding: 4px 8px;
            border-radius: 9999px;
            font-size: 0.65rem;
        }
        
        @media (min-width: 768px) {
            .sync-indicator {
                font-size: 0.75rem;
            }
        }
        
        .sync-online { background-color: #dcfce7; color: #166534; }
        .sync-offline { background-color: #fef3c7; color: #92400e; }
        .sync-syncing { background-color: #dbeafe; color: #1e40af; }
        
        /* Mobile Navigation */
        .mobile-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #e5e7eb;
            z-index: 1000;
            padding-bottom: env(safe-area-inset-bottom);
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
        }

        @media (min-width: 768px) {
            .mobile-nav {
                display: none;
            }
            
            .desktop-nav {
                display: flex;
            }
        }

        /* Hide scrollbar but allow scroll */
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        
        /* Mobile table scroll */
        .table-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        /* Responsive text */
        .text-responsive {
            font-size: 0.75rem;
        }
        
        @media (min-width: 640px) {
            .text-responsive {
                font-size: 0.875rem;
            }
        }
        
        /* Mobile card */
        .mobile-card {
            display: block;
        }
        
        @media (min-width: 1024px) {
            .mobile-card {
                display: none;
            }
        }
        
        /* Desktop table */
        .desktop-table {
            display: none;
        }
        
        @media (min-width: 1024px) {
            .desktop-table {
                display: table;
            }
        }
        
        /* Bottom padding for mobile nav */
        .main-content {
            padding-bottom: 100px;
        }

        @media (min-width: 768px) {
            .main-content {
                padding-bottom: 120px;
            }
        }

        @media (min-width: 1024px) {
            .main-content {
                padding-bottom: 40px;
            }
        }
        
        /* Header responsive */
        .header-title {
            font-size: 1.25rem;
        }
        
        @media (min-width: 768px) {
            .header-title {
                font-size: 1.5rem;
            }
        }
        
        /* Button responsive */
        .btn-responsive {
            padding: 0.5rem 0.75rem;
            font-size: 0.75rem;
        }
        
        @media (min-width: 768px) {
            .btn-responsive {
                padding: 0.5rem 1rem;
                font-size: 0.875rem;
            }
        }
        
        /* Input responsive */
        .input-responsive {
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
        }
        
        @media (min-width: 768px) {
            .input-responsive {
                padding: 0.625rem 0.875rem;
                font-size: 1rem;
            }
        }
        
        /* Dropdown menu */
        .dropdown-menu {
            position: absolute;
            right: 0;
            top: 100%;
            margin-top: 0.5rem;
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            min-width: 200px;
            z-index: 50;
        }

        /* LOGIN PAGE ANIMATIONS */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.5); }
            50% { box-shadow: 0 0 40px rgba(59, 130, 246, 0.8); }
        }

        .login-container {
            animation: fadeInUp 0.6s ease-out;
        }

        .login-logo {
            animation: float 3s ease-in-out infinite;
        }

        .login-input:focus {
            animation: glow 2s ease-in-out infinite;
        }

        .floating-shapes {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 0;
        }

        .shape {
            position: absolute;
            opacity: 0.1;
            animation: float 6s ease-in-out infinite;
        }

        .shape:nth-child(1) {
            top: 10%;
            left: 10%;
            width: 80px;
            height: 80px;
            background: linear-gradient(45deg, #3b82f6, #8b5cf6);
            border-radius: 50%;
            animation-delay: 0s;
        }

        .shape:nth-child(2) {
            top: 60%;
            right: 10%;
            width: 120px;
            height: 120px;
            background: linear-gradient(45deg, #ec4899, #f59e0b);
            border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%;
            animation-delay: 1s;
        }

        .shape:nth-child(3) {
            bottom: 20%;
            left: 15%;
            width: 100px;
            height: 100px;
            background: linear-gradient(45deg, #10b981, #3b82f6);
            border-radius: 20% 80% 20% 80% / 80% 20% 80% 20%;
            animation-delay: 2s;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Gochi+Hand&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-50">
    <div id="root">
        <div id="startup-loader">
            <div class="loader-circle"></div>
            <div class="loader-text">Motioncraft</div>
        </div>
    </div>

    <script type="text/babel">
        // =============================================
        // FIREBASE CONFIGURATION
        // =============================================
        
        const firebaseConfig = {
            apiKey: "AIzaSyCOumR96uJiZqijxAdlVKDDftv6KFyG8fI",
            authDomain: "motioncraft-c25ed.firebaseapp.com",
            projectId: "motioncraft-c25ed",
            storageBucket: "motioncraft-c25ed.firebasestorage.app",
            messagingSenderId: "572450999354",
            appId: "1:572450999354:web:67261e112a9dad49e57903",
            measurementId: "G-1L8JX4VQCQ"
        };

        // Firebase Lazy Initialization
        let app = null;
        let db = null;
        let auth = null;
        let analytics = null;

        function initializeFirebase() {
            if (!app) {
                app = firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                auth = firebase.auth();
                analytics = firebase.analytics();
                
                // Enable offline persistence
                db.enablePersistence().catch((err) => {
                    if (err.code === 'failed-precondition') {
                        console.log('Persistence failed: Multiple tabs open');
                    } else if (err.code === 'unimplemented') {
                        console.log('Persistence not available');
                    }
                });
            }
            return { app, db, auth, analytics };
        }

        // =============================================
        // CONFIGURATION
        // =============================================
        
        const CONFIG = {
            DEFAULT_DISPLAY_CURRENCY: "BDT",
            EXCHANGE_RATE_BDT_PER_USD: 105.25,
            DEFAULT_ADMIN_EMAIL: "direct.motioncraft@gmail.com",
            DEFAULT_ADMIN_PASSWORD: "112233",
            LOCAL_STORAGE_KEYS: {
                AUTH: "motioncraft_auth",
                USER: "motioncraft_user",
                ORDERS: "motioncraft_orders",
                TEAM: "motioncraft_team",
                CONTACTS: "motioncraft_contacts",
                ANNOUNCEMENTS: "motioncraft_announcements",
                ADMINS: "motioncraft_admins",
                LAST_SYNC: "motioncraft_last_sync"
            }
        };

        // =============================================
        // LOCAL STORAGE SERVICE
        // =============================================
        
        const LocalStorageService = {
            get(key) {
                try {
                    const item = localStorage.getItem(key);
                    return item ? JSON.parse(item) : null;
                } catch (error) {
                    console.error("Error reading from localStorage:", error);
                    return null;
                }
            },

            set(key, value) {
                try {
                    localStorage.setItem(key, JSON.stringify(value));
                    return true;
                } catch (error) {
                    console.error("Error writing to localStorage:", error);
                    return false;
                }
            },

            remove(key) {
                try {
                    localStorage.removeItem(key);
                    return true;
                } catch (error) {
                    console.error("Error removing from localStorage:", error);
                    return false;
                }
            },

            isAuthenticated() {
                const auth = this.get(CONFIG.LOCAL_STORAGE_KEYS.AUTH);
                return auth && auth.isLoggedIn && auth.expiry > Date.now();
            },

            setAuthenticated(value, user = null) {
                if (value) {
                    this.set(CONFIG.LOCAL_STORAGE_KEYS.AUTH, {
                        isLoggedIn: true,
                        expiry: Date.now() + (24 * 60 * 60 * 1000)
                    });
                    if (user) {
                        this.set(CONFIG.LOCAL_STORAGE_KEYS.USER, user);
                    }
                    return true;
                } else {
                    this.remove(CONFIG.LOCAL_STORAGE_KEYS.AUTH);
                    this.remove(CONFIG.LOCAL_STORAGE_KEYS.USER);
                    return true;
                }
            },

            getCurrentUser() {
                return this.get(CONFIG.LOCAL_STORAGE_KEYS.USER);
            },

            logout() {
                this.remove(CONFIG.LOCAL_STORAGE_KEYS.AUTH);
                this.remove(CONFIG.LOCAL_STORAGE_KEYS.USER);
            }
        };

        // =============================================
        // FIREBASE DATABASE SERVICE
        // =============================================

        const FirebaseService = {
            // Admin Management
            async getAdmins() {
                const { db } = initializeFirebase();
                try {
                    const snapshot = await db.collection('admins').get();
                    const admins = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    LocalStorageService.set(CONFIG.LOCAL_STORAGE_KEYS.ADMINS, admins);
                    return admins;
                } catch (error) {
                    console.error("Error getting admins:", error);
                    return LocalStorageService.get(CONFIG.LOCAL_STORAGE_KEYS.ADMINS) || [];
                }
            },

            async saveAdmin(admin) {
                const { db } = initializeFirebase();
                try {
                    await db.collection('admins').doc(admin.id).set(admin);
                    const admins = LocalStorageService.get(CONFIG.LOCAL_STORAGE_KEYS.ADMINS) || [];
                    const existingIndex = admins.findIndex(a => a.id === admin.id);
                    if (existingIndex >= 0) {
                        admins[existingIndex] = admin;
                    } else {
                        admins.push(admin);
                    }
                    LocalStorageService.set(CONFIG.LOCAL_STORAGE_KEYS.ADMINS, admins);
                    return { success: true };
                } catch (error) {
                    console.error("Error saving admin:", error);
                    throw error;
                }
            },

            async deleteAdmin(adminId) {
                const { db } = initializeFirebase();
                try {
                    await db.collection('admins').doc(adminId).delete();
                    const admins = LocalStorageService.get(CONFIG.LOCAL_STORAGE_KEYS.ADMINS) || [];
                    const filtered = admins.filter(a => a.id !== adminId);
                    LocalStorageService.set(CONFIG.LOCAL_STORAGE_KEYS.ADMINS, filtered);
                    return { success: true };
                } catch (error) {
                    console.error("Error deleting admin:", error);
                    throw error;
                }
            },

            async getOrders() {
                const { db } = initializeFirebase();
                try {
                    const snapshot = await db.collection('orders').orderBy('createdAt', 'desc').get();
                    const orders = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    LocalStorageService.set(CONFIG.LOCAL_STORAGE_KEYS.ORDERS, orders);
                    return orders;
                } catch (error) {
                    console.error("Error getting orders:", error);
                    return LocalStorageService.get(CONFIG.LOCAL_STORAGE_KEYS.ORDERS) || [];
                }
            },

            async saveOrder(order) {
                const { db } = initializeFirebase();
                try {
                    await db.collection('orders').doc(order.id).set(order);
                    const orders = LocalStorageService.get(CONFIG.LOCAL_STORAGE_KEYS.ORDERS) || [];
                    const existingIndex = orders.findIndex(o => o.id === order.id);
                    if (existingIndex >= 0) {
                        orders[existingIndex] = order;
                    } else {
                        orders.unshift(order);
                    }
                    LocalStorageService.set(CONFIG.LOCAL_STORAGE_KEYS.ORDERS, orders);
                    return { success: true };
                } catch (error) {
                    console.error("Error saving order:", error);
                    throw error;
                }
            },

            async deleteOrder(orderId) {
                const { db } = initializeFirebase();
                try {
                    await db.collection('orders').doc(orderId).delete();
                    const orders = LocalStorageService.get(CONFIG.LOCAL_STORAGE_KEYS.ORDERS) || [];
                    const filtered = orders.filter(o => o.id !== orderId);
                    LocalStorageService.set(CONFIG.LOCAL_STORAGE_KEYS.ORDERS, filtered);
                    return { success: true };
                } catch (error) {
                    console.error("Error deleting order:", error);
                    throw error;
                }
            },

            async getTeam() {
                const { db } = initializeFirebase();
                try {
                    const snapshot = await db.collection('team').get();
                    const team = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    LocalStorageService.set(CONFIG.LOCAL_STORAGE_KEYS.TEAM, team);
                    return team;
                } catch (error) {
                    console.error("Error getting team:", error);
                    return LocalStorageService.get(CONFIG.LOCAL_STORAGE_KEYS.TEAM) || [];
                }
            },

            async saveTeamMember(member) {
                const { db } = initializeFirebase();
                try {
                    await db.collection('team').doc(member.id).set(member);
                    const team = LocalStorageService.get(CONFIG.LOCAL_STORAGE_KEYS.TEAM) || [];
                    const existingIndex = team.findIndex(m => m.id === member.id);
                    if (existingIndex >= 0) {
                        team[existingIndex] = member;
                    } else {
                        team.push(member);
                    }
                    LocalStorageService.set(CONFIG.LOCAL_STORAGE_KEYS.TEAM, team);
                    return { success: true };
                } catch (error) {
                    console.error("Error saving team member:", error);
                    throw error;
                }
            },

            async deleteTeamMember(memberId) {
                const { db } = initializeFirebase();
                try {
                    await db.collection('team').doc(memberId).delete();
                    const team = LocalStorageService.get(CONFIG.LOCAL_STORAGE_KEYS.TEAM) || [];
                    const filtered = team.filter(m => m.id !== memberId);
                    LocalStorageService.set(CONFIG.LOCAL_STORAGE_KEYS.TEAM, filtered);
                    return { success: true };
                } catch (error) {
                    console.error("Error deleting team member:", error);
                    throw error;
                }
            },

            async getContacts() {
                const { db } = initializeFirebase();
                try {
                    const snapshot = await db.collection('contacts').get();
                    const contacts = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    LocalStorageService.set(CONFIG.LOCAL_STORAGE_KEYS.CONTACTS, contacts);
                    return contacts;
                } catch (error) {
                    console.error("Error getting contacts:", error);
                    return LocalStorageService.get(CONFIG.LOCAL_STORAGE_KEYS.CONTACTS) || [];
                }
            },

            async saveContact(contact) {
                const { db } = initializeFirebase();
                try {
                    const contactId = contact.id ? String(contact.id) : String(Date.now());
                    await db.collection('contacts').doc(contactId).set({ ...contact, id: contactId });
                    const contacts = LocalStorageService.get(CONFIG.LOCAL_STORAGE_KEYS.CONTACTS) || [];
                    const existingIndex = contacts.findIndex(c => String(c.id) === contactId);
                    if (existingIndex >= 0) {
                        contacts[existingIndex] = { ...contact, id: contactId };
                    } else {
                        contacts.push({ ...contact, id: contactId });
                    }
                    LocalStorageService.set(CONFIG.LOCAL_STORAGE_KEYS.CONTACTS, contacts);
                    return { success: true };
                } catch (error) {
                    console.error("Error saving contact:", error);
                    throw error;
                }
            },

            async deleteContact(contactId) {
                const { db } = initializeFirebase();
                try {
                    await db.collection('contacts').doc(String(contactId)).delete();
                    const contacts = LocalStorageService.get(CONFIG.LOCAL_STORAGE_KEYS.CONTACTS) || [];
                    const filtered = contacts.filter(c => String(c.id) !== String(contactId));
                    LocalStorageService.set(CONFIG.LOCAL_STORAGE_KEYS.CONTACTS, filtered);
                    return { success: true };
                } catch (error) {
                    console.error("Error deleting contact:", error);
                    throw error;
                }
            },

            async getAnnouncements() {
                const { db } = initializeFirebase();
                try {
                    const snapshot = await db.collection('announcements').orderBy('createdAt', 'desc').get();
                    const announcements = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    LocalStorageService.set(CONFIG.LOCAL_STORAGE_KEYS.ANNOUNCEMENTS, announcements);
                    return announcements;
                } catch (error) {
                    console.error("Error getting announcements:", error);
                    return LocalStorageService.get(CONFIG.LOCAL_STORAGE_KEYS.ANNOUNCEMENTS) || [];
                }
            },

            async saveAnnouncement(announcement) {
                const { db } = initializeFirebase();
                try {
                    const announcementId = announcement.id ? String(announcement.id) : String(Date.now());
                    await db.collection('announcements').doc(announcementId).set({ ...announcement, id: announcementId });
                    const announcements = LocalStorageService.get(CONFIG.LOCAL_STORAGE_KEYS.ANNOUNCEMENTS) || [];
                    const existingIndex = announcements.findIndex(a => String(a.id) === announcementId);
                    if (existingIndex >= 0) {
                        announcements[existingIndex] = { ...announcement, id: announcementId };
                    } else {
                        announcements.unshift({ ...announcement, id: announcementId });
                    }
                    LocalStorageService.set(CONFIG.LOCAL_STORAGE_KEYS.ANNOUNCEMENTS, announcements);
                    return { success: true };
                } catch (error) {
                    console.error("Error saving announcement:", error);
                    throw error;
                }
            },

            async deleteAnnouncement(announcementId) {
                const { db } = initializeFirebase();
                try {
                    await db.collection('announcements').doc(String(announcementId)).delete();
                    const announcements = LocalStorageService.get(CONFIG.LOCAL_STORAGE_KEYS.ANNOUNCEMENTS) || [];
                    const filtered = announcements.filter(a => String(a.id) !== String(announcementId));
                    LocalStorageService.set(CONFIG.LOCAL_STORAGE_KEYS.ANNOUNCEMENTS, filtered);
                    return { success: true };
                } catch (error) {
                    console.error("Error deleting announcement:", error);
                    throw error;
                }
            }
        };

        // =============================================
        // UTILITY FUNCTIONS
        // =============================================

        const formatPhoneNumber = (phone) => {
            return phone.replace(/\s+/g, '').replace(/^0/, '+880');
        };

        const openWhatsApp = (phone, message = "Hello from Motioncraft!") => {
            const formattedPhone = formatPhoneNumber(phone);
            const encodedMessage = encodeURIComponent(message);
            window.open(`https://wa.me/${formattedPhone}?text=${encodedMessage}`, '_blank');
        };

        const formatCurrency = (amount, currency, convert = false) => {
            if (convert && currency !== CONFIG.DEFAULT_DISPLAY_CURRENCY) {
                if (currency === "USD") {
                    amount = amount * CONFIG.EXCHANGE_RATE_BDT_PER_USD;
                } else if (currency === "BDT" && CONFIG.DEFAULT_DISPLAY_CURRENCY === "USD") {
                    amount = amount / CONFIG.EXCHANGE_RATE_BDT_PER_USD;
                }
                currency = CONFIG.DEFAULT_DISPLAY_CURRENCY;
            }

            if (currency === "USD") {
                return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(amount);
            } else {
                return new Intl.NumberFormat('en-BD', { style: 'currency', currency: 'BDT' }).format(amount);
            }
        };

        const getStatusClass = (status) => {
            return `status-${status.toLowerCase().replace(' ', '-')}`;
        };

        const getPaymentClass = (status) => {
            return `payment-${status.toLowerCase()}`;
        };

        const getInitials = (name) => {
            return name.split(' ').map(n => n[0]).join('').toUpperCase();
        };

        const isOverdue = (dueDate) => {
            return new Date(dueDate) < new Date();
        };

        const generateOrderId = (orders) => {
            if (orders.length === 0) return 'MC-001';
            const lastId = Math.max(...orders.map(order => parseInt(order.id.split('-')[1]) || 0));
            return `MC-${String(lastId + 1).padStart(3, '0')}`;
        };

        const getTeamMemberById = (id, team) => {
            return team.find(member => member.id === id) || { name: "Unassigned" };
        };

        const getCategoryColor = (category) => {
            const colors = {
                target: "bg-red-100 text-red-800",
                mission: "bg-blue-100 text-blue-800",
                dream: "bg-green-100 text-green-800",
                reminder: "bg-yellow-100 text-yellow-800",
                idea: "bg-purple-100 text-purple-800",
                general: "bg-gray-100 text-gray-800"
            };
            return colors[category] || colors.general;
        };

        const getPriorityColor = (priority) => {
            const colors = {
                high: "bg-red-500",
                medium: "bg-yellow-500",
                low: "bg-green-500"
            };
            return colors[priority] || colors.medium;
        };

        // =============================================
        // TOAST COMPONENT
        // =============================================

        const Toast = ({ message, type, onClose }) => {
            React.useEffect(() => {
                const timer = setTimeout(() => {
                    onClose();
                }, 3000);
                return () => clearTimeout(timer);
            }, [onClose]);

            return (
                <div className={`toast toast-${type}`}>
                    <div className="flex items-center justify-center">
                        {type === 'success' && <i className="fas fa-check-circle mr-2"></i>}
                        {type === 'error' && <i className="fas fa-exclamation-circle mr-2"></i>}
                        {type === 'info' && <i className="fas fa-info-circle mr-2"></i>}
                        <span>{message}</span>
                    </div>
                </div>
            );
        };

        // =============================================
        // MOBILE ORDER CARD COMPONENT
        // =============================================

        const MobileOrderCard = ({ order, team, onEdit, onPayment, onDelete, onStatusChange, onWhatsApp, onEditBudget }) => {
            const teamMember = getTeamMemberById(order.assignedEditor, team);
            
            const lastPayment = order.paymentHistory && order.paymentHistory.length > 0 
                ? order.paymentHistory[order.paymentHistory.length - 1] 
                : null;
            const paymentMethod = lastPayment ? lastPayment.method : null;
            const dueAmount = (order.price || 0) - (order.paidAmount || 0);

            return (
                <div className={`bg-white rounded-lg shadow-card p-4 mb-3 ${order.status === 'Fresh' ? 'new-order' : ''} ${isOverdue(order.dueDate) ? 'overdue' : ''}`}>
                    <div className="flex justify-between items-start mb-3">
                        <div>
                            <div className="font-bold text-gray-900">{order.id}</div>
                            <div className="text-sm text-gray-600">{order.clientName}</div>
                        </div>
                        <div className="text-right">
                            <span className={`px-2 py-1 text-xs rounded-full font-medium ${getStatusClass(order.status)}`}>
                                {order.status}
                            </span>
                        </div>
                    </div>
                    
                    <div className="grid grid-cols-2 gap-2 text-sm mb-3">
                        <div>
                            <span className="text-gray-500 text-xs">Price:</span>
                            <div className="font-medium text-sm">{formatCurrency(order.price, order.currency)}</div>
                        </div>
                        <div>
                            <span className="text-gray-500 text-xs">Due Amount:</span>
                            <div className={`font-medium text-sm ${dueAmount > 0 ? 'text-red-600' : 'text-green-600'}`}>
                                {formatCurrency(dueAmount, order.currency)}
                            </div>
                        </div>
                        <div>
                            <span className="text-gray-500 text-xs">Payment Status:</span>
                            <div className="flex items-center">
                                <span className={`px-2 py-0.5 text-xs rounded-full font-medium ${getPaymentClass(order.paymentStatus)}`}>
                                    {order.paymentStatus}
                                </span>
                            </div>
                        </div>
                        <div>
                            <span className="text-gray-500 text-xs">Method:</span>
                            <div className="font-medium text-sm text-gray-700">
                                {paymentMethod ? (
                                    <span className="flex items-center">
                                        <i className="fas fa-wallet mr-1 text-xs text-gray-400"></i> {paymentMethod}
                                    </span>
                                ) : '-'}
                            </div>
                        </div>
                        <div className="col-span-2 pt-2 border-t border-gray-100 mt-1">
                            <div className="flex justify-between items-center">
                                <div>
                                    <span className="text-gray-500 text-xs">Editor: </span>
                                    <span className="text-sm font-medium text-gray-900">
                                        {order.assignedEditor ? teamMember.name : 'Unassigned'}
                                    </span>
                                </div>
                                <div className="text-xs text-blue-600 bg-blue-50 px-2 py-1 rounded flex items-center">
                                    Team Budget: {formatCurrency(order.teamBudget || 0, order.currency)}
                                    <button onClick={() => onEditBudget(order)} className="ml-2 text-blue-800"><i className="fas fa-edit"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="bg-gray-50 rounded-lg p-2 mb-3">
                        <div className="flex justify-between text-xs text-gray-600 mb-1">
                            <span>Paid: {formatCurrency(order.paidAmount || 0, order.currency)}</span>
                            <span>{Math.min(((order.paidAmount || 0) / order.price) * 100, 100).toFixed(0)}%</span>
                        </div>
                        <div className="w-full bg-gray-200 rounded-full h-2">
                            <div 
                                className={`h-2 rounded-full ${order.paymentStatus === 'Paid' ? 'bg-green-500' : order.paymentStatus === 'Partial' ? 'bg-yellow-500' : 'bg-gray-300'}`}
                                style={{ width: `${Math.min(((order.paidAmount || 0) / order.price) * 100, 100)}%` }}
                            ></div>
                        </div>
                    </div>
                    
                    <div className="flex justify-between items-center border-t pt-3">
                        <select
                            value={order.status}
                            onChange={(e) => onStatusChange(order.id, e.target.value)}
                            className={`text-xs border rounded-lg px-2 py-1.5 font-medium ${getStatusClass(order.status)}`}
                        >
                            <option value="Fresh">Fresh</option>
                            <option value="Scripting">Scripting</option>
                            <option value="Editing">Editing</option>
                            <option value="Correction">Correction</option>
                            <option value="Final Delivery">Final Delivery</option>
                            <option value="Completed">Completed</option>
                        </select>
                        
                        <div className="flex space-x-3">
                            <button onClick={() => onWhatsApp(order.clientPhone)} className="text-green-600 text-lg p-1"><i className="fab fa-whatsapp"></i></button>
                            <button onClick={() => onEdit(order)} className="text-blue-600 text-lg p-1"><i className="fas fa-edit"></i></button>
                            <button onClick={() => onPayment(order)} className="text-purple-600 text-lg p-1"><i className="fas fa-money-bill-wave"></i></button>
                            <button onClick={() => onDelete(order.id)} className="text-red-600 text-lg p-1"><i className="fas fa-trash"></i></button>
                        </div>
                    </div>
                </div>
            );
        };

        // =============================================
        // MOBILE TEAM CARD COMPONENT
        // =============================================

        const MobileTeamCard = ({ member, onEdit, onDelete, onWhatsApp }) => {
            return (
                <div className="bg-white rounded-lg shadow-card p-4 mb-3">
                    <div className="flex items-center mb-4">
                        <div className="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 text-lg font-bold">
                            {getInitials(member.name)}
                        </div>
                        <div className="ml-3 flex-1">
                            <h3 className="font-semibold text-gray-900">{member.name}</h3>
                            <p className="text-sm text-gray-500">{member.role}</p>
                        </div>
                        <span className={`px-2 py-1 text-xs rounded-full ${member.active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>
                            {member.active ? 'Active' : 'Inactive'}
                        </span>
                    </div>
                    
                    <div className="grid grid-cols-2 gap-3 text-sm mb-4">
                        <div>
                            <span className="text-gray-500">Active Projects:</span>
                            <div className="font-semibold text-lg">{member.activeProjects}</div>
                        </div>
                        <div>
                            <span className="text-gray-500">Completed:</span>
                            <div className="font-semibold text-lg">{member.completedThisMonth}</div>
                        </div>
                    </div>

                    <div className="mb-4 bg-gray-50 p-3 rounded-lg flex justify-between items-center">
                        <span className="text-gray-600 text-sm">Budget Used:</span>
                        <span className="font-bold text-gray-900 text-lg">
                            {formatCurrency(member.budgetUsed || 0, member.currency)}
                        </span>
                    </div>
                    
                    <div className="flex space-x-2">
                        <button onClick={() => onWhatsApp(member.phone, `Hi ${member.name}!`)} className="flex-1 bg-green-50 text-green-700 py-2 rounded-lg text-sm font-medium">
                            <i className="fab fa-whatsapp mr-1"></i> WhatsApp
                        </button>
                        <button onClick={() => onEdit(member)} className="flex-1 bg-blue-50 text-blue-700 py-2 rounded-lg text-sm font-medium">
                            <i className="fas fa-edit mr-1"></i> Edit
                        </button>
                        <button onClick={() => onDelete(member.id)} className="bg-red-50 text-red-700 py-2 px-3 rounded-lg text-sm font-medium">
                            <i className="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            );
        };

        // =============================================
        // MOBILE CONTACT CARD COMPONENT
        // =============================================

        const MobileContactCard = ({ contact, onEdit, onDelete, onWhatsApp }) => {
            return (
                <div className="bg-white rounded-lg shadow-card p-4 mb-3">
                    <div className="flex items-center justify-between mb-3">
                        <div className="flex items-center">
                            <div className="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center text-gray-600 font-medium">
                                {getInitials(contact.name)}
                            </div>
                            <div className="ml-3">
                                <div className="font-medium text-gray-900">{contact.name}</div>
                                <div className="text-sm text-gray-500">{contact.phone}</div>
                            </div>
                        </div>
                        <span className="px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800">
                            {contact.type}
                        </span>
                    </div>
                    
                    {contact.email && (
                        <div className="text-sm text-gray-600 mb-3">
                            <i className="fas fa-envelope mr-2"></i>{contact.email}
                        </div>
                    )}
                    
                                        <div className="flex space-x-2">
                        <button onClick={() => onWhatsApp(contact.phone)} className="flex-1 bg-green-50 text-green-700 py-2 rounded-lg text-sm font-medium">
                            <i className="fab fa-whatsapp mr-1"></i> WhatsApp
                        </button>
                        <button onClick={() => onEdit(contact)} className="flex-1 bg-blue-50 text-blue-700 py-2 rounded-lg text-sm font-medium">
                            <i className="fas fa-edit mr-1"></i> Edit
                        </button>
                        <button onClick={() => onDelete(contact.id)} className="bg-red-50 text-red-700 py-2 px-3 rounded-lg text-sm font-medium">
                            <i className="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            );
        };

        // =============================================
        // MAIN DASHBOARD COMPONENT
        // =============================================

        const Dashboard = () => {
            // All State Variables
            const [activeTab, setActiveTab] = React.useState('overview');
            const [orders, setOrders] = React.useState([]);
            const [team, setTeam] = React.useState([]);
            const [contacts, setContacts] = React.useState([]);
            const [announcements, setAnnouncements] = React.useState([]);
            const [admins, setAdmins] = React.useState([]);
            const [filters, setFilters] = React.useState({
                status: '',
                editor: '',
                paymentStatus: '',
                search: ''
            });
            const [announcementFilter, setAnnouncementFilter] = React.useState('all');
            const [selectedMonth, setSelectedMonth] = React.useState(new Date().toISOString().slice(0, 7));
            
            // Auth States
            const [isAuthenticated, setIsAuthenticated] = React.useState(() => LocalStorageService.isAuthenticated());
            const [currentUser, setCurrentUser] = React.useState(() => LocalStorageService.getCurrentUser());
            const [loginEmail, setLoginEmail] = React.useState('');
            const [loginPassword, setLoginPassword] = React.useState('');
            const [showPassword, setShowPassword] = React.useState(false);
            const [isLoggingIn, setIsLoggingIn] = React.useState(false);
            const [loginError, setLoginError] = React.useState('');
            
            // Forgot Password States
            const [showForgotPassword, setShowForgotPassword] = React.useState(false);
            const [forgotEmail, setForgotEmail] = React.useState('');
            const [forgotEmailError, setForgotEmailError] = React.useState('');
            const [forgotEmailSuccess, setForgotEmailSuccess] = React.useState('');
            const [isSendingReset, setIsSendingReset] = React.useState(false);
            
            // Modal States
            const [showOrderModal, setShowOrderModal] = React.useState(false);
            const [showContactModal, setShowContactModal] = React.useState(false);
            const [showTeamModal, setShowTeamModal] = React.useState(false);
            const [showPaymentModal, setShowPaymentModal] = React.useState(false);
            const [showAnnouncementModal, setShowAnnouncementModal] = React.useState(false);
            const [showBudgetModal, setShowBudgetModal] = React.useState(false);
            const [showChangePasswordModal, setShowChangePasswordModal] = React.useState(false);
            const [showUserMenu, setShowUserMenu] = React.useState(false);
            const [showAdminModal, setShowAdminModal] = React.useState(false);
            const [showTeamPaymentModal, setShowTeamPaymentModal] = React.useState(false);
            
            // Current Item States
            const [currentOrder, setCurrentOrder] = React.useState(null);
            const [currentContact, setCurrentContact] = React.useState(null);
            const [currentTeamMember, setCurrentTeamMember] = React.useState(null);
            const [currentAnnouncement, setCurrentAnnouncement] = React.useState(null);
            const [currentAdmin, setCurrentAdmin] = React.useState(null);
            const [selectedOrders, setSelectedOrders] = React.useState([]);
            const [notificationCount, setNotificationCount] = React.useState(0);
            
                        // Loading States
            const [isLoading, setIsLoading] = React.useState(() => LocalStorageService.isAuthenticated());
            const [syncStatus, setSyncStatus] = React.useState('online');
            const [toast, setToast] = React.useState(null);
            const [passwordChange, setPasswordChange] = React.useState({
                currentPassword: '',
                newPassword: '',
                confirmPassword: ''
            });
            const [isSaving, setIsSaving] = React.useState(false);

            // Activity Log States (NEW)
            const [activityLogs, setActivityLogs] = React.useState([]);
            const [showActivityLogModal, setShowActivityLogModal] = React.useState(false);

                        // Show toast notification
            const showToast = (message, type = 'info') => {
                setToast({ message, type });
            };

            // =============================================
            // ROLE-BASED ACCESS CONTROL & ACTIVITY LOGGER
            // =============================================
            
            // Check if current user is the Original Admin
            const isOriginalAdmin = () => {
                return currentUser?.email?.toLowerCase() === CONFIG.DEFAULT_ADMIN_EMAIL.toLowerCase();
            };

            // Get current user role from admins list
            const getCurrentUserRole = () => {
                if (isOriginalAdmin()) return 'Original Admin';
                const adminData = admins.find(a => a.email?.toLowerCase() === currentUser?.email?.toLowerCase());
                return adminData?.role || 'Admin';
            };

                        // =============================================
            // ENHANCED ACTIVITY LOGGER - Track EVERYTHING
            // =============================================
            const logActivity = async (action, details, extraData = {}) => {
                try {
                    const { db } = initializeFirebase();
                    const logEntry = {
                        id: String(Date.now()) + '_' + Math.random().toString(36).substr(2, 9),
                        action: action,
                        details: details,
                        extraData: extraData,
                        performedBy: {
                            email: currentUser?.email || 'Unknown',
                            name: currentUser?.displayName || 'Unknown',
                            uid: currentUser?.uid || 'Unknown'
                        },
                        timestamp: new Date().toISOString(),
                        date: new Date().toLocaleDateString('en-GB'),
                        time: new Date().toLocaleTimeString('en-US', { hour12: true }),
                        userAgent: navigator.userAgent,
                        platform: navigator.platform
                    };
                    
                    await db.collection('activityLogs').doc(logEntry.id).set(logEntry);
                } catch (error) {
                    console.error('Error logging activity:', error);
                }
            };

            // Log with before/after comparison for detailed tracking
            const logDetailedChange = async (action, itemType, itemId, oldData, newData) => {
                const changes = [];
                
                // Compare old and new data to find changes
                if (oldData && newData) {
                    Object.keys(newData).forEach(key => {
                        if (JSON.stringify(oldData[key]) !== JSON.stringify(newData[key])) {
                            changes.push({
                                field: key,
                                oldValue: oldData[key],
                                newValue: newData[key]
                            });
                        }
                    });
                }
                
                const details = changes.length > 0 
                    ? `Updated ${itemType} (${itemId}): ${changes.map(c => `${c.field}: "${c.oldValue || 'empty'}"  "${c.newValue}"`).join(', ')}`
                    : `Updated ${itemType} (${itemId})`;
                
                await logActivity(action, details, {
                    itemType,
                    itemId,
                    changes,
                    oldData,
                    newData
                });
            };

            // Remove the Loading Spinner immediately after React Mounts
            React.useLayoutEffect(() => {
                const loader = document.getElementById('startup-loader');
                if (loader) {
                    loader.style.opacity = '0';
                    setTimeout(() => loader.remove(), 500);
                }
            }, []);

                        // =============================================
            // INITIALIZE DATA & REAL-TIME LISTENERS
            // =============================================
            React.useEffect(() => {
                if (!isAuthenticated) return;
                
                const { db } = initializeFirebase();
                let unsubscribeActivityLogs = null;

                const loadData = async () => {
                    // First load from localStorage (FAST)
                    const cachedOrders = LocalStorageService.get(CONFIG.LOCAL_STORAGE_KEYS.ORDERS);
                    const cachedTeam = LocalStorageService.get(CONFIG.LOCAL_STORAGE_KEYS.TEAM);
                    const cachedContacts = LocalStorageService.get(CONFIG.LOCAL_STORAGE_KEYS.CONTACTS);
                    const cachedAnnouncements = LocalStorageService.get(CONFIG.LOCAL_STORAGE_KEYS.ANNOUNCEMENTS);
                    const cachedAdmins = LocalStorageService.get(CONFIG.LOCAL_STORAGE_KEYS.ADMINS);

                    if (cachedOrders) setOrders(cachedOrders);
                    if (cachedTeam) setTeam(cachedTeam);
                    if (cachedContacts) setContacts(cachedContacts);
                    if (cachedAnnouncements) setAnnouncements(cachedAnnouncements);
                    if (cachedAdmins) setAdmins(cachedAdmins);

                    setIsLoading(false);
                    setSyncStatus('syncing');
                    
                    // Then sync from Firebase (background)
                    try {
                        const [ordersData, teamData, contactsData, announcementsData, adminsData] = await Promise.all([
                            FirebaseService.getOrders(),
                            FirebaseService.getTeam(),
                            FirebaseService.getContacts(),
                            FirebaseService.getAnnouncements(),
                            FirebaseService.getAdmins()
                        ]);
                        
                        setOrders(ordersData);
                        setTeam(teamData);
                        setContacts(contactsData);
                        setAnnouncements(announcementsData);
                        setAdmins(adminsData);
                        
                        setSyncStatus('online');
                        LocalStorageService.set(CONFIG.LOCAL_STORAGE_KEYS.LAST_SYNC, Date.now());
                    } catch (error) {
                        console.error("Error loading data:", error);
                        setSyncStatus('offline');
                        showToast('Running in offline mode', 'info');
                    }
                };
                
                loadData();

                // ========================================
                //  REAL-TIME LISTENER: ORDERS
                // ========================================
                const unsubscribeOrders = db.collection('orders')
                    .orderBy('createdAt', 'desc')
                    .onSnapshot((snapshot) => {
                        const ordersData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        setOrders(ordersData);
                        LocalStorageService.set(CONFIG.LOCAL_STORAGE_KEYS.ORDERS, ordersData);
                        setSyncStatus('online');
                    }, (error) => {
                        console.error("Orders listener error:", error);
                        setSyncStatus('offline');
                    });

                // ========================================
                //  REAL-TIME LISTENER: TEAM
                // ========================================
                const unsubscribeTeam = db.collection('team')
                    .onSnapshot((snapshot) => {
                        const teamData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        setTeam(teamData);
                        LocalStorageService.set(CONFIG.LOCAL_STORAGE_KEYS.TEAM, teamData);
                        setSyncStatus('online');
                    }, (error) => {
                        console.error("Team listener error:", error);
                    });

                // ========================================
                //  REAL-TIME LISTENER: CONTACTS
                // ========================================
                const unsubscribeContacts = db.collection('contacts')
                    .onSnapshot((snapshot) => {
                        const contactsData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        setContacts(contactsData);
                        LocalStorageService.set(CONFIG.LOCAL_STORAGE_KEYS.CONTACTS, contactsData);
                        setSyncStatus('online');
                    }, (error) => {
                        console.error("Contacts listener error:", error);
                    });

                // ========================================
                //  REAL-TIME LISTENER: ANNOUNCEMENTS
                // ========================================
                const unsubscribeAnnouncements = db.collection('announcements')
                    .orderBy('createdAt', 'desc')
                    .onSnapshot((snapshot) => {
                        const announcementsData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        setAnnouncements(announcementsData);
                        LocalStorageService.set(CONFIG.LOCAL_STORAGE_KEYS.ANNOUNCEMENTS, announcementsData);
                        setSyncStatus('online');
                    }, (error) => {
                        console.error("Announcements listener error:", error);
                    });

                // ========================================
                //  REAL-TIME LISTENER: ADMINS
                // ========================================
                const unsubscribeAdmins = db.collection('admins')
                    .onSnapshot((snapshot) => {
                        const adminsData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        setAdmins(adminsData);
                        LocalStorageService.set(CONFIG.LOCAL_STORAGE_KEYS.ADMINS, adminsData);
                        setSyncStatus('online');
                    }, (error) => {
                        console.error("Admins listener error:", error);
                    });

                // ========================================
                //  REAL-TIME LISTENER: ACTIVITY LOGS
                // (Only for Original Admin)
                // ========================================
                const userEmail = LocalStorageService.getCurrentUser()?.email;
                if (userEmail?.toLowerCase() === CONFIG.DEFAULT_ADMIN_EMAIL.toLowerCase()) {
                    unsubscribeActivityLogs = db.collection('activityLogs')
                        .orderBy('timestamp', 'desc')
                        .limit(100)
                        .onSnapshot((snapshot) => {
                            const logsData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                            setActivityLogs(logsData);
                            console.log('Activity logs updated in real-time:', logsData.length);
                        }, (error) => {
                            console.error("Activity logs listener error:", error);
                        });
                }

                // ========================================
                //  ONLINE/OFFLINE STATUS MONITOR
                // ========================================
                const handleOnline = () => {
                    setSyncStatus('online');
                    showToast('Internet connection restored', 'success');
                };
                
                const handleOffline = () => {
                    setSyncStatus('offline');
                    showToast('You are offline. Changes will sync later.', 'info');
                };

                window.addEventListener('online', handleOnline);
                window.addEventListener('offline', handleOffline);

                // ========================================
                //  CLEANUP ON UNMOUNT
                // ========================================
                return () => {
                    unsubscribeOrders();
                    unsubscribeTeam();
                    unsubscribeContacts();
                    unsubscribeAnnouncements();
                    unsubscribeAdmins();
                    if (unsubscribeActivityLogs) {
                        unsubscribeActivityLogs();
                    }
                    window.removeEventListener('online', handleOnline);
                    window.removeEventListener('offline', handleOffline);
                };
            }, [isAuthenticated]);

            // Calculate financials
            const financials = React.useMemo(() => {
                const currentMonthOrders = orders.filter(order => 
                    order.createdAt && order.createdAt.startsWith(selectedMonth)
                );

                const totalIncome = currentMonthOrders
                    .filter(order => order.paymentStatus === 'Paid' || order.paymentStatus === 'Partial')
                    .reduce((sum, order) => {
                        let amount = order.paidAmount || 0;
                        if (order.currency !== CONFIG.DEFAULT_DISPLAY_CURRENCY) {
                            amount = order.currency === 'USD' 
                                ? order.paidAmount * CONFIG.EXCHANGE_RATE_BDT_PER_USD 
                                : order.paidAmount / CONFIG.EXCHANGE_RATE_BDT_PER_USD;
                        }
                        return sum + amount;
                    }, 0);

                const pendingAmount = currentMonthOrders
                    .filter(order => order.paymentStatus === 'Pending' || order.paymentStatus === 'Partial')
                    .reduce((sum, order) => {
                        let amount = (order.price || 0) - (order.paidAmount || 0);
                        if (order.currency !== CONFIG.DEFAULT_DISPLAY_CURRENCY) {
                            amount = order.currency === 'USD' 
                                ? amount * CONFIG.EXCHANGE_RATE_BDT_PER_USD 
                                : amount / CONFIG.EXCHANGE_RATE_BDT_PER_USD;
                        }
                        return sum + amount;
                    }, 0);

                const totalExpenses = totalIncome * 0.3;
                const netProfit = totalIncome - totalExpenses;

                return {
                    totalIncome,
                    totalExpenses,
                    netProfit,
                    pendingAmount
                };
            }, [orders, selectedMonth]);

            // Filter orders
            const filteredOrders = React.useMemo(() => {
                return orders.filter(order => {
                    return (
                        (filters.status === '' || order.status === filters.status) &&
                        (filters.editor === '' || order.assignedEditor === filters.editor) &&
                        (filters.paymentStatus === '' || order.paymentStatus === filters.paymentStatus) &&
                        (filters.search === '' || 
                         (order.id && order.id.toLowerCase().includes(filters.search.toLowerCase())) ||
                         (order.clientName && order.clientName.toLowerCase().includes(filters.search.toLowerCase())))
                    );
                });
            }, [orders, filters]);

            // Filter announcements
            const filteredAnnouncements = React.useMemo(() => {
                if (announcementFilter === 'all') return announcements;
                return announcements.filter(announcement => announcement.category === announcementFilter);
            }, [announcements, announcementFilter]);

            // Calculate team workload
            const teamWorkload = React.useMemo(() => {
                return team.map(member => {
                    const memberOrders = orders.filter(order => 
                        order.assignedEditor === member.id && 
                        order.status !== 'Completed'
                    );
                    
                    const completedThisMonth = orders.filter(order => 
                        order.assignedEditor === member.id && 
                        order.status === 'Completed' &&
                        order.createdAt && order.createdAt.startsWith(selectedMonth)
                    ).length;

                    const monthlyOrders = orders.filter(order => 
                        order.assignedEditor === member.id &&
                        order.createdAt && order.createdAt.startsWith(selectedMonth)
                    );
                    
                    const budgetUsed = monthlyOrders.reduce((sum, order) => {
                        let budgetAmount = order.teamBudget || 0;
                        if (order.currency !== member.currency) {
                            if (order.currency === "USD" && member.currency === "BDT") {
                                budgetAmount = budgetAmount * CONFIG.EXCHANGE_RATE_BDT_PER_USD;
                            } else if (order.currency === "BDT" && member.currency === "USD") {
                                budgetAmount = budgetAmount / CONFIG.EXCHANGE_RATE_BDT_PER_USD;
                            }
                        }
                        return sum + budgetAmount;
                    }, 0);
                    
                    return {
                        ...member,
                        activeProjects: memberOrders.length,
                        completedThisMonth,
                        budgetUsed,
                        budgetPercentage: member.monthlyBudget ? (budgetUsed / member.monthlyBudget) * 100 : 0
                    };
                });
            }, [team, orders, selectedMonth]);

            // Notification count
            React.useEffect(() => {
                const newOrdersCount = orders.filter(order => 
                    order.status === 'Fresh' && 
                    order.createdAt &&
                    new Date(order.createdAt) > new Date(Date.now() - 24 * 60 * 60 * 1000)
                ).length;
                setNotificationCount(newOrdersCount);
            }, [orders]);

                        // =============================================
            // LOGIN HANDLER - Firebase Auth (WITH BLOCK CHECK)
            // =============================================
            const handleLogin = async (e) => {
                e.preventDefault();
                setIsLoggingIn(true);
                setLoginError('');
                
                try {
                    const { auth, db } = initializeFirebase();
                    const userCredential = await auth.signInWithEmailAndPassword(loginEmail, loginPassword);
                    const user = userCredential.user;
                    
                    // Check if user is blocked in admins collection
                    const adminsSnapshot = await db.collection('admins').where('email', '==', user.email).get();
                    
                    if (!adminsSnapshot.empty) {
                        const adminData = adminsSnapshot.docs[0].data();
                        if (adminData.status === 'blocked') {
                            // Sign out blocked user
                            await auth.signOut();
                            setLoginError('Your account has been blocked. Contact the main admin.');
                            setIsLoggingIn(false);
                            return;
                        }
                    }
                    
                    // Login successful
                    LocalStorageService.setAuthenticated(true, {
                        uid: user.uid,
                        email: user.email,
                        displayName: user.displayName || user.email.split('@')[0]
                    });
                    
                    setCurrentUser({
                        uid: user.uid,
                        email: user.email,
                        displayName: user.displayName || user.email.split('@')[0]
                    });
                    setIsAuthenticated(true);
                    showToast(`Welcome back, ${user.displayName || user.email.split('@')[0]}!`, 'success');
                                        // Log login activity
                    setTimeout(async () => {
                        try {
                            const { db } = initializeFirebase();
                            await db.collection('activityLogs').doc(String(Date.now())).set({
                                id: String(Date.now()),
                                action: 'ADMIN_LOGIN',
                                details: `Admin logged in: ${user.email}`,
                                performedBy: {
                                    email: user.email,
                                    name: user.displayName || user.email.split('@')[0],
                                    uid: user.uid
                                },
                                timestamp: new Date().toISOString(),
                                date: new Date().toLocaleDateString('en-GB'),
                                time: new Date().toLocaleTimeString('en-US', { hour12: true }),
                                userAgent: navigator.userAgent,
                                platform: navigator.platform
                            });
                        } catch (e) {
                            console.log('Login log error:', e);
                        }
                    }, 1000);
                } catch (error) {
                    console.error("Login error:", error);
                    let errorMessage = 'Login failed. Please try again.';
                    
                    if (error.code === 'auth/user-not-found') {
                        errorMessage = 'No account found with this email.';
                    } else if (error.code === 'auth/wrong-password') {
                        errorMessage = 'Incorrect password. Please try again.';
                    } else if (error.code === 'auth/invalid-email') {
                        errorMessage = 'Invalid email format.';
                    } else if (error.code === 'auth/too-many-requests') {
                        errorMessage = 'Too many failed attempts. Try again later.';
                    } else if (error.code === 'auth/invalid-credential') {
                        errorMessage = 'Invalid email or password.';
                    }
                    
                    setLoginError(errorMessage);
                } finally {
                    setIsLoggingIn(false);
                }
            };

                        // =============================================
            // FORGOT PASSWORD HANDLER (ADMIN VERIFIED)
            // =============================================
            const handleForgotPassword = async (e) => {
                e.preventDefault();
                setForgotEmailError('');
                setForgotEmailSuccess('');
                setIsSendingReset(true);
                
                try {
                    const { auth, db } = initializeFirebase();
                    
                    // Step 1: Check if email is the main admin
                    const isMainAdmin = forgotEmail.toLowerCase() === CONFIG.DEFAULT_ADMIN_EMAIL.toLowerCase();
                    
                    // Step 2: Check if email exists in admins collection
                    let isRegisteredAdmin = false;
                    let isBlocked = false;
                    
                    if (!isMainAdmin) {
                        const adminsSnapshot = await db.collection('admins')
                            .where('email', '==', forgotEmail.toLowerCase())
                            .get();
                        
                        if (!adminsSnapshot.empty) {
                            isRegisteredAdmin = true;
                            const adminData = adminsSnapshot.docs[0].data();
                            if (adminData.status === 'blocked') {
                                isBlocked = true;
                            }
                        }
                    }
                    
                    // Step 3: Validate and send reset email
                    if (!isMainAdmin && !isRegisteredAdmin) {
                        // Email not found in admin list
                        setForgotEmailError('Wrong email. This email is not registered as an admin.');
                        setIsSendingReset(false);
                        return;
                    }
                    
                    if (isBlocked) {
                        // Admin is blocked
                        setForgotEmailError('This account has been blocked. Contact the main admin.');
                        setIsSendingReset(false);
                        return;
                    }
                    
                    // Step 4: Send password reset email
                    await auth.sendPasswordResetEmail(forgotEmail);
                    
                    setForgotEmailSuccess('Password reset link has been sent to your inbox. Please also check your spam folder.');
                    setForgotEmail('');
                    
                } catch (error) {
                    console.error("Password reset error:", error);
                    
                    if (error.code === 'auth/user-not-found') {
                        setForgotEmailError('Wrong email. No account found with this email.');
                    } else if (error.code === 'auth/invalid-email') {
                        setForgotEmailError('Invalid email format. Please enter a valid email.');
                    } else if (error.code === 'auth/too-many-requests') {
                        setForgotEmailError('Too many requests. Please try again later.');
                    } else {
                        setForgotEmailError('Failed to send reset email. Please try again.');
                    }
                } finally {
                    setIsSendingReset(false);
                }
            };

            // Logout handler
                        const handleLogout = async () => {
                try {
                    // Log logout before signing out
                    const { db, auth } = initializeFirebase();
                    await db.collection('activityLogs').doc(String(Date.now())).set({
                        id: String(Date.now()),
                        action: 'ADMIN_LOGOUT',
                        details: `Admin logged out: ${currentUser?.email}`,
                        performedBy: {
                            email: currentUser?.email || 'Unknown',
                            name: currentUser?.displayName || 'Unknown',
                            uid: currentUser?.uid || 'Unknown'
                        },
                        timestamp: new Date().toISOString(),
                        date: new Date().toLocaleDateString('en-GB'),
                        time: new Date().toLocaleTimeString('en-US', { hour12: true }),
                        userAgent: navigator.userAgent,
                        platform: navigator.platform
                    });
                    
                    await auth.signOut();
                } catch (error) {
                    console.error("Logout error:", error);
                }
                
                LocalStorageService.logout();
                setIsAuthenticated(false);
                setCurrentUser(null);
                setLoginEmail('');
                setLoginPassword('');
                setShowUserMenu(false);
                showToast('Logged out successfully!', 'success');
            };

            // Change password handler
            const handleChangePassword = async () => {
                if (isSaving) return;
                
                const { currentPassword, newPassword, confirmPassword } = passwordChange;
                
                if (!currentPassword || !newPassword || !confirmPassword) {
                    showToast('Please fill all fields', 'error');
                    return;
                }

                if (newPassword !== confirmPassword) {
                    showToast('New passwords do not match', 'error');
                    return;
                }

                if (newPassword.length < 6) {
                    showToast('Password must be at least 6 characters', 'error');
                    return;
                }

                setIsSaving(true);
                try {
                    const { auth } = initializeFirebase();
                    const user = auth.currentUser;
                    
                    // Re-authenticate
                    const credential = firebase.auth.EmailAuthProvider.credential(user.email, currentPassword);
                    await user.reauthenticateWithCredential(credential);
                    
                    // Update password
                    await user.updatePassword(newPassword);
                    
                    setShowChangePasswordModal(false);
                    setPasswordChange({ currentPassword: '', newPassword: '', confirmPassword: '' });
                    showToast('Password changed successfully!', 'success');
                } catch (error) {
                    console.error("Error changing password:", error);
                    if (error.code === 'auth/wrong-password') {
                        showToast('Current password is incorrect', 'error');
                    } else {
                        showToast('Error changing password. Please try again.', 'error');
                    }
                } finally {
                    setIsSaving(false);
                }
            };

            const handleFilterChange = (key, value) => {
                setFilters(prev => ({ ...prev, [key]: value }));
            };

            // Order handlers
            const updateOrderStatus = async (orderId, newStatus) => {
                if (isSaving) return;
                
                setIsSaving(true);
                try {
                    const orderToUpdate = orders.find(o => o.id === orderId);
                    if (orderToUpdate) {
                        const updatedOrder = { ...orderToUpdate, status: newStatus };
                        await FirebaseService.saveOrder(updatedOrder);
                        showToast('Status updated', 'success');
                    }
                } catch (error) {
                    console.error("Error updating order status:", error);
                    showToast('Error updating status', 'error');
                } finally {
                    setIsSaving(false);
                }
            };

            const updatePaymentStatus = async (orderId, paymentData) => {
                try {
                    const orderToUpdate = orders.find(o => o.id === orderId);
                    if (orderToUpdate) {
                        const newPaymentHistory = [
                            ...(orderToUpdate.paymentHistory || []),
                            {
                                date: paymentData.date,
                                amount: paymentData.amount,
                                method: paymentData.method,
                                note: paymentData.note
                            }
                        ];
                        
                        const newPaidAmount = (orderToUpdate.paidAmount || 0) + paymentData.amount;
                        
                        let newPaymentStatus = 'Pending';
                        if (newPaidAmount >= orderToUpdate.price) {
                            newPaymentStatus = 'Paid';
                        } else if (newPaidAmount > 0) {
                            newPaymentStatus = 'Partial';
                        }
                        
                        const updatedOrder = {
                            ...orderToUpdate,
                            paymentStatus: newPaymentStatus,
                            paidAmount: newPaidAmount,
                            paymentHistory: newPaymentHistory
                        };
                        
                        await FirebaseService.saveOrder(updatedOrder);
                        showToast('Payment recorded', 'success');
                    }
                } catch (error) {
                    console.error("Error updating payment:", error);
                    showToast('Error recording payment', 'error');
                }
            };

                        const assignEditor = async (orderId, editorId) => {
                if (isSaving) return;
                
                setIsSaving(true);
                try {
                    const orderToUpdate = orders.find(o => o.id === orderId);
                    if (orderToUpdate) {
                        const oldEditor = orderToUpdate.assignedEditor;
                        const oldEditorName = oldEditor ? getTeamMemberById(oldEditor, team).name : 'Unassigned';
                        const newEditorName = editorId ? getTeamMemberById(editorId, team).name : 'Unassigned';
                        
                        const updatedOrder = { ...orderToUpdate, assignedEditor: editorId };
                        await FirebaseService.saveOrder(updatedOrder);
                        
                        // Detailed Log
                        await logActivity('EDITOR_ASSIGNED', 
                            `Changed editor for order ${orderId} (${orderToUpdate.clientName}): "${oldEditorName}"  "${newEditorName}"`,
                            { orderId, clientName: orderToUpdate.clientName, oldEditor: oldEditorName, newEditor: newEditorName }
                        );
                        
                        showToast('Editor assigned', 'success');
                    }
                } catch (error) {
                    console.error("Error assigning editor:", error);
                    showToast('Error assigning editor', 'error');
                } finally {
                    setIsSaving(false);
                }
            };

            const handleCreateOrder = () => {
                setCurrentOrder({
                    id: generateOrderId(orders),
                    clientName: '',
                    clientPhone: '',
                    serviceType: 'Corporate Video',
                    price: 0,
                    currency: CONFIG.DEFAULT_DISPLAY_CURRENCY,
                    dueDate: new Date().toISOString().slice(0, 10),
                    assignedEditor: '',
                    status: 'Fresh',
                    notes: '',
                    paymentStatus: 'Pending',
                    paidAmount: 0,
                    teamBudget: 0,
                    paymentHistory: [],
                    createdAt: new Date().toISOString().slice(0, 10)
                });
                setShowOrderModal(true);
            };

            const handleEditOrder = (order) => {
                setCurrentOrder({...order});
                setShowOrderModal(true);
            };

                                    const handleSaveOrder = async () => {
                if (isSaving) return;
                
                if (currentOrder.id && currentOrder.clientName && currentOrder.clientPhone) {
                    setIsSaving(true);
                    try {
                        const existingOrder = orders.find(o => o.id === currentOrder.id);
                        const isNew = !existingOrder;
                        
                        await FirebaseService.saveOrder(currentOrder);
                        
                        // Detailed Activity Log
                        if (isNew) {
                            await logActivity('ORDER_CREATED', 
                                `Created new order ${currentOrder.id} for "${currentOrder.clientName}" - Service: ${currentOrder.serviceType}, Price: ${currentOrder.price} ${currentOrder.currency}`,
                                { orderData: currentOrder }
                            );
                        } else {
                            await logDetailedChange('ORDER_UPDATED', 'Order', currentOrder.id, existingOrder, currentOrder);
                        }
                        
                        setShowOrderModal(false);
                        setCurrentOrder(null);
                        showToast('Order saved', 'success');
                    } catch (error) {
                        console.error("Error saving order:", error);
                        showToast('Error saving order', 'error');
                    } finally {
                        setIsSaving(false);
                    }
                } else {
                    showToast('Please fill all required fields', 'error');
                }
            };

                         const handleDeleteOrder = async (orderId) => {
                if (isSaving) return;
                
                if (confirm('Are you sure you want to delete this order?')) {
                    setIsSaving(true);
                    try {
                        const orderToDelete = orders.find(o => o.id === orderId);
                        await FirebaseService.deleteOrder(orderId);
                        
                        // Log activity
                        await logActivity('ORDER_DELETED', `Deleted order ${orderId} (${orderToDelete?.clientName || 'Unknown'})`);
                        
                        showToast('Order deleted', 'success');
                    } catch (error) {
                        console.error("Error deleting order:", error);
                        showToast('Error deleting order', 'error');
                    } finally {
                        setIsSaving(false);
                    }
                }
            };

            // Contact handlers
            const handleCreateContact = () => {
                setCurrentContact({
                    id: '',
                    name: '',
                    phone: '',
                    email: '',
                    type: 'Client'
                });
                setShowContactModal(true);
            };

            const handleEditContact = (contact) => {
                setCurrentContact({...contact});
                setShowContactModal(true);
            };

                        const handleSaveContact = async () => {
                if (isSaving) return;
                
                if (currentContact.name && currentContact.phone) {
                    setIsSaving(true);
                    try {
                        const existingContact = contacts.find(c => String(c.id) === String(currentContact.id));
                        const isNew = !existingContact;
                        
                        await FirebaseService.saveContact(currentContact);
                        
                        // Detailed Log
                        if (isNew) {
                            await logActivity('CONTACT_ADDED', 
                                `Added new contact: "${currentContact.name}" (${currentContact.phone}) - Type: ${currentContact.type}`,
                                { contactData: currentContact }
                            );
                        } else {
                            await logDetailedChange('CONTACT_UPDATED', 'Contact', currentContact.id, existingContact, currentContact);
                        }
                        
                        setShowContactModal(false);
                        setCurrentContact(null);
                        showToast('Contact saved', 'success');
                    } catch (error) {
                        console.error("Error saving contact:", error);
                        showToast('Error saving contact', 'error');
                    } finally {
                        setIsSaving(false);
                    }
                } else {
                    showToast('Please fill all required fields', 'error');
                }
            };

                        const handleDeleteContact = async (contactId) => {
                if (isSaving) return;
                
                if (confirm('Are you sure you want to delete this contact?')) {
                    setIsSaving(true);
                    try {
                        const contactToDelete = contacts.find(c => String(c.id) === String(contactId));
                        await FirebaseService.deleteContact(contactId);
                        
                        // Log deletion with full data
                        await logActivity('CONTACT_DELETED', 
                            `Deleted contact: "${contactToDelete?.name}" (${contactToDelete?.phone})`,
                            { deletedContact: contactToDelete }
                        );
                        
                        showToast('Contact deleted', 'success');
                    } catch (error) {
                        console.error("Error deleting contact:", error);
                        showToast('Error deleting contact', 'error');
                    } finally {
                        setIsSaving(false);
                    }
                }
            };

            // Team handlers
            const handleCreateTeamMember = () => {
                setCurrentTeamMember({
                    id: String(Date.now()),
                    name: '',
                    email: '',
                    phone: '',
                    role: 'Video Editor',
                    currency: CONFIG.DEFAULT_DISPLAY_CURRENCY,
                    active: true
                });
                setShowTeamModal(true);
            };

            const handleEditTeamMember = (member) => {
                setCurrentTeamMember({...member});
                setShowTeamModal(true);
            };

                                    const handleSaveTeamMember = async () => {
                if (isSaving) return;
                
                if (currentTeamMember.name && currentTeamMember.email) {
                    setIsSaving(true);
                    try {
                        const existingMember = team.find(m => m.id === currentTeamMember.id);
                        const isNew = !existingMember;
                        
                        await FirebaseService.saveTeamMember(currentTeamMember);
                        
                        // Detailed Log
                        if (isNew) {
                            await logActivity('TEAM_MEMBER_ADDED', 
                                `Added new team member: "${currentTeamMember.name}" (${currentTeamMember.email}) - Role: ${currentTeamMember.role}`,
                                { memberData: currentTeamMember }
                            );
                        } else {
                            await logDetailedChange('TEAM_MEMBER_UPDATED', 'Team Member', currentTeamMember.id, existingMember, currentTeamMember);
                        }
                        
                        setShowTeamModal(false);
                        setCurrentTeamMember(null);
                        showToast('Team member saved', 'success');
                    } catch (error) {
                        console.error("Error saving team member:", error);
                        showToast('Error saving team member', 'error');
                    } finally {
                        setIsSaving(false);
                    }
                } else {
                    showToast('Please fill all required fields', 'error');
                }
            };

                        const handleDeleteTeamMember = async (memberId) => {
                if (isSaving) return;
                
                if (confirm('Are you sure you want to delete this team member?')) {
                    setIsSaving(true);
                    try {
                        const memberToDelete = team.find(m => m.id === memberId);
                        const memberOrders = orders.filter(o => o.assignedEditor === memberId);
                        for (const order of memberOrders) {
                            await FirebaseService.saveOrder({ ...order, assignedEditor: '' });
                        }
                        await FirebaseService.deleteTeamMember(memberId);
                        
                        // Log activity
                        await logActivity('TEAM_MEMBER_DELETED', `Deleted team member: ${memberToDelete?.name || memberId}`);
                        
                        showToast('Team member deleted', 'success');
                    } catch (error) {
                        console.error("Error deleting team member:", error);
                        showToast('Error deleting team member', 'error');
                    } finally {
                        setIsSaving(false);
                    }
                }
            };

            // Payment handler
            const handleAddPayment = (order) => {
                setCurrentOrder({
                    ...order, 
                    paymentAmount: 0, 
                    paymentDate: new Date().toISOString().slice(0, 10), 
                    paymentMethod: '', 
                    paymentNote: ''
                });
                setShowPaymentModal(true);
            };

                        const handleSavePayment = async (paymentData) => {
                if (isSaving) return;
                
                if (paymentData.amount > 0 && paymentData.date && paymentData.method) {
                    setIsSaving(true);
                    try {
                        const oldPaidAmount = currentOrder.paidAmount || 0;
                        const oldPaymentStatus = currentOrder.paymentStatus;
                        
                        await updatePaymentStatus(currentOrder.id, paymentData);
                        
                        // Detailed Log
                        await logActivity('PAYMENT_RECORDED', 
                            `Recorded payment for order ${currentOrder.id} (${currentOrder.clientName}): ${paymentData.amount} ${currentOrder.currency} via ${paymentData.method}. Total paid: ${oldPaidAmount}  ${oldPaidAmount + paymentData.amount} ${currentOrder.currency}`,
                            {
                                orderId: currentOrder.id,
                                clientName: currentOrder.clientName,
                                paymentAmount: paymentData.amount,
                                paymentMethod: paymentData.method,
                                paymentDate: paymentData.date,
                                paymentNote: paymentData.note,
                                oldPaidAmount,
                                newPaidAmount: oldPaidAmount + paymentData.amount,
                                orderTotal: currentOrder.price,
                                currency: currentOrder.currency
                            }
                        );
                        
                        setShowPaymentModal(false);
                        setCurrentOrder(null);
                    } catch (error) {
                        console.error("Error saving payment:", error);
                        showToast('Error saving payment', 'error');
                    } finally {
                        setIsSaving(false);
                    }
                } else {
                    showToast('Please fill all payment details', 'error');
                }
            };

            // Announcement handlers
            const handleCreateAnnouncement = () => {
                setCurrentAnnouncement({
                    id: '',
                    title: '',
                    content: '',
                    category: 'general',
                    color: 'yellow',
                    priority: 'medium',
                    createdAt: new Date().toISOString().slice(0, 10)
                });
                setShowAnnouncementModal(true);
            };

            const handleEditAnnouncement = (announcement) => {
                setCurrentAnnouncement({...announcement});
                setShowAnnouncementModal(true);
            };

                const handleSaveAnnouncement = async () => {
                    if (isSaving) return;
                    
                    if (currentAnnouncement.title && currentAnnouncement.content) {
                        setIsSaving(true);
                        try {
                            await FirebaseService.saveAnnouncement(currentAnnouncement);
                            setShowAnnouncementModal(false);
                            setCurrentAnnouncement(null);
                            showToast('Announcement saved', 'success');
                        } catch (error) {
                            console.error("Error saving announcement:", error);
                            showToast('Error saving announcement', 'error');
                        } finally {
                            setIsSaving(false);
                        }
                    } else {
                        showToast('Please fill title and content', 'error');
                    }
                };
    
                            const handleDeleteAnnouncement = async (announcementId) => {
                    if (isSaving) return;
                    
                    if (confirm('Are you sure you want to delete this announcement?')) {
                        setIsSaving(true);
                        try {
                            const announcementToDelete = announcements.find(a => String(a.id) === String(announcementId));
                            await FirebaseService.deleteAnnouncement(announcementId);
                            
                            // Log deletion
                            await logActivity('ANNOUNCEMENT_DELETED', 
                                `Deleted announcement: "${announcementToDelete?.title}"`,
                                { deletedAnnouncement: announcementToDelete }
                            );
                            
                            showToast('Announcement deleted', 'success');
                        } catch (error) {
                            console.error("Error deleting announcement:", error);
                            showToast('Error deleting announcement', 'error');
                        } finally {
                            setIsSaving(false);
                        }
                    }
                };
    
            // Team budget handler
            const handleEditTeamBudget = (order) => {
                setCurrentOrder({...order});
                setShowBudgetModal(true);
            };

                        const handleSaveTeamBudget = async () => {
                if (isSaving) return;
                
                if (currentOrder.teamBudget >= 0) {
                    setIsSaving(true);
                    try {
                        const existingOrder = orders.find(o => o.id === currentOrder.id);
                        const oldBudget = existingOrder?.teamBudget || 0;
                        
                        await FirebaseService.saveOrder(currentOrder);
                        
                        // Detailed Log
                        await logActivity('TEAM_BUDGET_CHANGED', 
                            `Changed team budget for order ${currentOrder.id} (${currentOrder.clientName}): ${oldBudget} ${currentOrder.currency}  ${currentOrder.teamBudget} ${currentOrder.currency}`,
                            { orderId: currentOrder.id, oldBudget, newBudget: currentOrder.teamBudget, currency: currentOrder.currency }
                        );
                        
                        setShowBudgetModal(false);
                        setCurrentOrder(null);
                        showToast('Team budget saved', 'success');
                    } catch (error) {
                        console.error("Error saving team budget:", error);
                        showToast('Error saving team budget', 'error');
                    } finally {
                        setIsSaving(false);
                    }
                } else {
                    showToast('Team budget cannot be negative', 'error');
                }
            };

            // Team Payment Functions
            const handleOpenTeamPayment = (order) => {
                setCurrentOrder({
                    ...order,
                    teamPaidAmount: order.teamPaidAmount || 0,
                    teamPaymentStatus: order.teamPaymentStatus || 'Pending'
                });
                setShowTeamPaymentModal(true);
            };

                        const handleSaveTeamPayment = async (amount, isFull = false) => {
                if (isSaving) return;
                setIsSaving(true);
                try {
                    const oldPaidAmount = currentOrder.teamPaidAmount || 0;
                    const oldStatus = currentOrder.teamPaymentStatus || 'Pending';
                    
                    let newPaidAmount = parseFloat(amount) || 0;
                    let newStatus = 'Pending';
                    const budget = currentOrder.teamBudget || 0;

                    if (isFull || newPaidAmount >= budget) {
                        newPaidAmount = budget;
                        newStatus = 'Paid';
                    } else if (newPaidAmount > 0) {
                        newStatus = 'Partial';
                    }

                    const updatedOrder = { 
                        ...currentOrder, 
                        teamPaidAmount: newPaidAmount,
                        teamPaymentStatus: newStatus
                    };

                    const editorName = currentOrder.assignedEditor 
                        ? getTeamMemberById(currentOrder.assignedEditor, team).name 
                        : 'Unassigned';

                    await FirebaseService.saveOrder(updatedOrder);
                    
                    // Detailed Log
                    await logActivity('TEAM_PAYMENT_UPDATED', 
                        `Updated team payment for order ${currentOrder.id} (Editor: ${editorName}): ${oldPaidAmount}  ${newPaidAmount} ${currentOrder.currency} (Status: ${oldStatus}  ${newStatus})`,
                        { 
                            orderId: currentOrder.id, 
                            editor: editorName,
                            oldPaidAmount, 
                            newPaidAmount, 
                            oldStatus, 
                            newStatus,
                            budget,
                            currency: currentOrder.currency
                        }
                    );
                    
                    setShowTeamPaymentModal(false);
                    setCurrentOrder(null);
                    showToast('Team payment updated', 'success');
                } catch (error) {
                    console.error("Error saving team payment:", error);
                    showToast('Error updating team payment', 'error');
                } finally {
                    setIsSaving(false);
                }
            };

                                    // =============================================
            // ADMIN MANAGEMENT HANDLERS (WITH ACTIVITY LOG)
            // =============================================
            const handleCreateAdmin = () => {
                // Only original admin can create admins
                if (!isOriginalAdmin()) {
                    showToast('Only the Original Admin can add new admins', 'error');
                    return;
                }
                
                setCurrentAdmin({
                    id: String(Date.now()),
                    email: '',
                    name: '',
                    password: '',
                    showPassword: false,
                    role: 'Admin',
                    status: 'active',
                    createdAt: new Date().toISOString().slice(0, 10),
                    createdBy: currentUser?.email || ''
                });
                setShowAdminModal(true);
            };

            const handleEditAdmin = (admin) => {
                // Only original admin can edit admins
                if (!isOriginalAdmin()) {
                    showToast('Only the Original Admin can edit admins', 'error');
                    return;
                }
                
                setCurrentAdmin({...admin, password: '', showPassword: false, isEditing: true});
                setShowAdminModal(true);
            };

            const handleSaveAdmin = async () => {
                if (isSaving) return;
                
                // Only original admin can save admins
                if (!isOriginalAdmin()) {
                    showToast('Only the Original Admin can manage admins', 'error');
                    return;
                }
                
                if (!currentAdmin.email || !currentAdmin.name) {
                    showToast('Please fill email and name', 'error');
                    return;
                }

                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(currentAdmin.email)) {
                    showToast('Please enter a valid email', 'error');
                    return;
                }

                const isNewAdmin = !currentAdmin.isEditing;

                if (isNewAdmin && (!currentAdmin.password || currentAdmin.password.length < 6)) {
                    showToast('Password must be at least 6 characters', 'error');
                    return;
                }

                setIsSaving(true);
                try {
                    const { auth } = initializeFirebase();
                    
                    if (isNewAdmin) {
                        try {
                            const userCredential = await auth.createUserWithEmailAndPassword(
                                currentAdmin.email, 
                                currentAdmin.password
                            );
                            
                            await userCredential.user.updateProfile({
                                displayName: currentAdmin.name
                            });

                            const newUserUid = userCredential.user.uid;
                            await auth.signOut();
                            
                            const adminData = {
                                id: currentAdmin.id,
                                email: currentAdmin.email,
                                name: currentAdmin.name,
                                role: currentAdmin.role,
                                status: currentAdmin.status,
                                uid: newUserUid,
                                createdAt: currentAdmin.createdAt,
                                createdBy: currentAdmin.createdBy
                            };

                            await FirebaseService.saveAdmin(adminData);
                            
                            // Log activity
                            await logActivity('ADMIN_CREATED', `Created new admin: ${currentAdmin.name} (${currentAdmin.email}) - Role: ${currentAdmin.role}`);
                            
                            setShowAdminModal(false);
                            setCurrentAdmin(null);
                            
                            showToast(`Admin "${currentAdmin.name}" created successfully!`, 'success');
                            
                            setTimeout(() => {
                                alert(` New Admin Created!\n\n Email: ${currentAdmin.email}\n Password: ${currentAdmin.password}\n\n Please share these credentials securely with the new admin.\n\nThey can change their password after logging in.`);
                            }, 500);
                            
                        } catch (authError) {
                            console.error("Auth error:", authError);
                            
                            if (authError.code === 'auth/email-already-in-use') {
                                showToast('This email is already registered', 'error');
                            } else if (authError.code === 'auth/invalid-email') {
                                showToast('Invalid email format', 'error');
                            } else if (authError.code === 'auth/weak-password') {
                                showToast('Password is too weak (min 6 characters)', 'error');
                            } else {
                                showToast('Error: ' + authError.message, 'error');
                            }
                            setIsSaving(false);
                            return;
                        }
                    } else {
                        const adminData = {
                            id: currentAdmin.id,
                            email: currentAdmin.email,
                            name: currentAdmin.name,
                            role: currentAdmin.role,
                            status: currentAdmin.status,
                            uid: currentAdmin.uid || '',
                            createdAt: currentAdmin.createdAt,
                            createdBy: currentAdmin.createdBy
                        };
                        
                        await FirebaseService.saveAdmin(adminData);
                        
                        // Log activity
                        await logActivity('ADMIN_UPDATED', `Updated admin: ${currentAdmin.name} (${currentAdmin.email}) - Role: ${currentAdmin.role}`);
                        
                        setShowAdminModal(false);
                        setCurrentAdmin(null);
                        showToast('Admin updated successfully', 'success');
                    }
                } catch (error) {
                    console.error("Error saving admin:", error);
                    showToast('Error saving admin', 'error');
                } finally {
                    setIsSaving(false);
                }
            };

            const handleBlockAdmin = async (admin) => {
                if (isSaving) return;
                
                // Only original admin can block
                if (!isOriginalAdmin()) {
                    showToast('Only the Original Admin can block/unblock admins', 'error');
                    return;
                }
                
                if (admin.email === currentUser?.email) {
                    showToast('You cannot block yourself', 'error');
                    return;
                }
                
                const newStatus = admin.status === 'blocked' ? 'active' : 'blocked';
                const action = newStatus === 'blocked' ? 'block' : 'unblock';
                
                if (confirm(`Are you sure you want to ${action} ${admin.name}?\n\n${newStatus === 'blocked' ? 'They will not be able to login.' : 'They will be able to login again.'}`)) {
                    setIsSaving(true);
                    try {
                        await FirebaseService.saveAdmin({...admin, status: newStatus});
                        
                        // Log activity
                        await logActivity(
                            newStatus === 'blocked' ? 'ADMIN_BLOCKED' : 'ADMIN_UNBLOCKED',
                            `${newStatus === 'blocked' ? 'Blocked' : 'Unblocked'} admin: ${admin.name} (${admin.email})`
                        );
                        
                        showToast(`${admin.name} has been ${action}ed`, 'success');
                    } catch (error) {
                        console.error("Error updating admin:", error);
                        showToast('Error updating admin', 'error');
                    } finally {
                        setIsSaving(false);
                    }
                }
            };

            const handleDeleteAdmin = async (adminId, adminEmail, adminName) => {
                if (isSaving) return;
                
                // Only original admin can delete
                if (!isOriginalAdmin()) {
                    showToast('Only the Original Admin can delete admins', 'error');
                    return;
                }
                
                if (adminEmail === currentUser?.email) {
                    showToast('You cannot delete yourself', 'error');
                    return;
                }
                
                if (confirm(` Delete Admin: ${adminName}\n\nThis will:\n Remove from admin list\n They won't be able to access dashboard\n\nContinue?`)) {
                    setIsSaving(true);
                    try {
                        await FirebaseService.deleteAdmin(adminId);
                        
                        // Log activity
                        await logActivity('ADMIN_DELETED', `Deleted admin: ${adminName} (${adminEmail})`);
                        
                        showToast(`${adminName} removed from admins`, 'success');
                    } catch (error) {
                        console.error("Error deleting admin:", error);
                        showToast('Error deleting admin', 'error');
                    } finally {
                        setIsSaving(false);
                    }
                }
            };

            const handleSendPasswordReset = async (email, name) => {
                // Only original admin can send reset
                if (!isOriginalAdmin()) {
                    showToast('Only the Original Admin can send password resets', 'error');
                    return;
                }
                
                try {
                    const { auth } = initializeFirebase();
                    await auth.sendPasswordResetEmail(email);
                    
                    // Log activity
                    await logActivity('PASSWORD_RESET_SENT', `Sent password reset to: ${name} (${email})`);
                    
                    showToast(`Password reset link sent to ${name}`, 'success');
                } catch (error) {
                    console.error("Error sending reset:", error);
                    showToast('Failed to send reset email', 'error');
                }
            };

            // Bulk actions
            const toggleOrderSelection = (orderId) => {
                setSelectedOrders(prev => 
                    prev.includes(orderId) 
                        ? prev.filter(id => id !== orderId)
                        : [...prev, orderId]
                );
            };

            const handleBulkPaymentStatus = async (status) => {
                if (isSaving) return;
                
                if (selectedOrders.length === 0) {
                    showToast('Please select at least one order', 'error');
                    return;
                }
                
                setIsSaving(true);
                try {
                    for (const orderId of selectedOrders) {
                        const orderToUpdate = orders.find(o => o.id === orderId);
                        if (orderToUpdate) {
                            await FirebaseService.saveOrder({ ...orderToUpdate, paymentStatus: status });
                        }
                    }
                    setSelectedOrders([]);
                    showToast('Bulk update completed', 'success');
                } catch (error) {
                    console.error("Error updating bulk payment status:", error);
                    showToast('Error updating bulk status', 'error');
                } finally {
                    setIsSaving(false);
                }
            };

            // Export functions
            const exportCSV = () => {
                const headers = ['OrderID', 'ClientName', 'Phone', 'ServiceType', 'Price', 'Currency', 'TeamBudget', 'ConvertedPrice', 'Status', 'AssignedEditor', 'PaymentStatus', 'PaidAmount', 'CreatedAt'];
                
                const csvData = filteredOrders.map(order => {
                    const convertedPrice = order.currency !== CONFIG.DEFAULT_DISPLAY_CURRENCY
                        ? order.currency === 'USD'
                            ? order.price * CONFIG.EXCHANGE_RATE_BDT_PER_USD
                            : order.price / CONFIG.EXCHANGE_RATE_BDT_PER_USD
                        : order.price;
                    
                    const teamMember = getTeamMemberById(order.assignedEditor, team);
                    
                    return [
                        order.id,
                        order.clientName,
                        order.clientPhone,
                        order.serviceType,
                        order.price,
                        order.currency,
                        order.teamBudget || 0,
                        convertedPrice,
                        order.status,
                        teamMember.name,
                        order.paymentStatus,
                        order.paidAmount || 0,
                        order.createdAt
                    ];
                });
                
                const csvContent = [headers, ...csvData]
                    .map(row => row.map(field => `"${field}"`).join(','))
                    .join('\n');
                
                const blob = new Blob([csvContent], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `motioncraft-orders-${new Date().toISOString().slice(0, 10)}.csv`;
                a.click();
                URL.revokeObjectURL(url);
                showToast('CSV exported', 'success');
            };

            const exportPDF = () => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                doc.setFontSize(18);
                doc.text('Motioncraft Orders Report', 14, 15);
                
                doc.setFontSize(10);
                doc.text(`Generated on: ${new Date().toLocaleDateString()}`, 14, 22);
                
                const tableData = filteredOrders.map(order => {
                    const teamMember = getTeamMemberById(order.assignedEditor, team);
                    return [
                        order.id,
                        order.clientName,
                        order.serviceType,
                        formatCurrency(order.price, order.currency),
                        formatCurrency(order.teamBudget || 0, order.currency),
                        order.status,
                        teamMember.name,
                        order.paymentStatus,
                        formatCurrency(order.paidAmount || 0, order.currency)
                    ];
                });
                
                doc.autoTable({
                    startY: 30,
                    head: [['Order ID', 'Client', 'Service', 'Price', 'Team Budget', 'Status', 'Editor', 'Payment', 'Paid']],
                    body: tableData,
                    theme: 'grid',
                    styles: { fontSize: 8 },
                    headStyles: { fillColor: [59, 130, 246] }
                });
                
                doc.save(`motioncraft-orders-${new Date().toISOString().slice(0, 10)}.pdf`);
                showToast('PDF exported', 'success');
            };

            const printOrders = () => {
                const printContent = document.createElement('div');
                printContent.innerHTML = `
                    <h1>Motioncraft Orders Report</h1>
                    <p>Generated on: ${new Date().toLocaleDateString()}</p>
                    <table border="1" style="width:100%; border-collapse:collapse;">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Client</th>
                                <th>Service</th>
                                <th>Price</th>
                                <th>Team Budget</th>
                                <th>Status</th>
                                <th>Editor</th>
                                <th>Payment</th>
                                <th>Paid</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${filteredOrders.map(order => {
                                const teamMember = getTeamMemberById(order.assignedEditor, team);
                                return `
                                    <tr>
                                        <td>${order.id}</td>
                                        <td>${order.clientName}</td>
                                        <td>${order.serviceType}</td>
                                        <td>${formatCurrency(order.price, order.currency)}</td>
                                        <td>${formatCurrency(order.teamBudget || 0, order.currency)}</td>
                                        <td>${order.status}</td>
                                        <td>${teamMember.name}</td>
                                        <td>${order.paymentStatus}</td>
                                        <td>${formatCurrency(order.paidAmount || 0, order.currency)}</td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                `;
                
                const printWindow = window.open('', '_blank');
                printWindow.document.write(printContent.innerHTML);
                printWindow.document.close();
                printWindow.print();
            };

            // =============================================
            // LOADING STATE
            // =============================================
            if (isAuthenticated && isLoading) {
                return (
                    <div className="min-h-screen bg-gray-50 flex flex-col justify-center items-center p-4">
                        <div className="animate-spin rounded-full h-12 w-12 md:h-16 md:w-16 border-t-2 border-b-2 border-blue-500"></div>
                        <p className="mt-4 text-gray-600 text-sm md:text-base">Loading Dashboard...</p>
                    </div>
                );
            }

            // =============================================
            // PROFESSIONAL ANIMATED LOGIN PAGE
            // =============================================
            if (!isAuthenticated) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-900 via-purple-900 to-indigo-900 flex flex-col justify-center items-center p-4 relative overflow-hidden">
                        {toast && <Toast message={toast.message} type={toast.type} onClose={() => setToast(null)} />}
                        
                        {/* Floating Animated Shapes */}
                        <div className="floating-shapes">
                            <div className="shape"></div>
                            <div className="shape"></div>
                            <div className="shape"></div>
                        </div>
                        
                        {/* Animated Particles */}
                        <div className="absolute inset-0 overflow-hidden pointer-events-none">
                            {[...Array(20)].map((_, i) => (
                                <div
                                    key={i}
                                    className="absolute rounded-full bg-white opacity-10"
                                    style={{
                                        width: Math.random() * 10 + 5 + 'px',
                                        height: Math.random() * 10 + 5 + 'px',
                                        left: Math.random() * 100 + '%',
                                        top: Math.random() * 100 + '%',
                                        animation: `float ${Math.random() * 10 + 10}s ease-in-out infinite`,
                                        animationDelay: Math.random() * 5 + 's'
                                    }}
                                />
                            ))}
                        </div>
                        
                        {/* Main Login Container */}
                        <div className="login-container w-full max-w-md relative z-10">
                            {/* Logo Section */}
                            <div className="text-center mb-8">
                                <div className="login-logo inline-block mb-4">
                                    <div className="w-20 h-20 md:w-24 md:h-24 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-2xl transform rotate-3 hover:rotate-0 transition-transform duration-300">
                                        <i className="fas fa-video text-white text-3xl md:text-4xl"></i>
                                    </div>
                                </div>
                                <h1 className="text-3xl md:text-4xl font-bold text-white mb-2 tracking-tight">
                                    Motioncraft
                                </h1>
                                <p className="text-blue-200 text-sm md:text-base">Owner Dashboard</p>
                            </div>
                            
                            {/* Login Card */}
                            <div className="bg-white/10 backdrop-blur-xl rounded-3xl shadow-2xl p-6 md:p-8 border border-white/20">
                                {!showForgotPassword ? (
                                    // Login Form
                                    <form onSubmit={handleLogin} className="space-y-5">
                                        <div className="text-center mb-6">
                                            <h2 className="text-xl md:text-2xl font-semibold text-white">Welcome Back</h2>
                                            <p className="text-blue-200 text-sm mt-1">Sign in to continue</p>
                                        </div>
                                        
                                        {loginError && (
                                            <div className="bg-red-500/20 border border-red-500/50 rounded-xl p-3 flex items-center animate-pulse">
                                                <i className="fas fa-exclamation-circle text-red-400 mr-2"></i>
                                                <span className="text-red-200 text-sm">{loginError}</span>
                                            </div>
                                        )}
                                        
                                        {/* Email Input */}
                                        <div className="space-y-2">
                                            <label className="block text-blue-200 text-sm font-medium">Email Address</label>
                                            <div className="relative">
                                                <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                                    <i className="fas fa-envelope text-blue-300"></i>
                                                </div>
                                                <input
                                                    type="email"
                                                    value={loginEmail}
                                                    onChange={(e) => setLoginEmail(e.target.value)}
                                                    className="login-input w-full pl-12 pr-4 py-3.5 bg-white/10 border border-white/20 rounded-xl text-white placeholder-blue-300 focus:outline-none focus:border-blue-400 focus:bg-white/20 transition-all duration-300"
                                                    placeholder="Enter your email"
                                                    required
                                                />
                                            </div>
                                        </div>
                                        
                                        {/* Password Input */}
                                        <div className="space-y-2">
                                            <label className="block text-blue-200 text-sm font-medium">Password</label>
                                            <div className="relative">
                                                <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                                    <i className="fas fa-lock text-blue-300"></i>
                                                </div>
                                                <input
                                                    type={showPassword ? "text" : "password"}
                                                    value={loginPassword}
                                                    onChange={(e) => setLoginPassword(e.target.value)}
                                                    className="login-input w-full pl-12 pr-12 py-3.5 bg-white/10 border border-white/20 rounded-xl text-white placeholder-blue-300 focus:outline-none focus:border-blue-400 focus:bg-white/20 transition-all duration-300"
                                                    placeholder="Enter your password"
                                                    required
                                                />
                                                <button
                                                    type="button"
                                                    onClick={() => setShowPassword(!showPassword)}
                                                    className="absolute inset-y-0 right-0 pr-4 flex items-center text-blue-300 hover:text-white transition-colors"
                                                >
                                                    <i className={`fas ${showPassword ? 'fa-eye-slash' : 'fa-eye'}`}></i>
                                                </button>
                                            </div>
                                        </div>
                                        
                                        {/* Login Button */}
                                        <button
                                            type="submit"
                                            disabled={isLoggingIn}
                                            className={`w-full py-3.5 rounded-xl font-semibold text-white transition-all duration-300 transform hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center space-x-2 ${
                                                isLoggingIn 
                                                    ? 'bg-blue-500/50 cursor-not-allowed' 
                                                    : 'bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 shadow-lg hover:shadow-xl'
                                            }`}
                                        >
                                            {isLoggingIn ? (
                                                <>
                                                    <div className="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                                                    <span>Signing in...</span>
                                                </>
                                            ) : (
                                                <>
                                                    <i className="fas fa-sign-in-alt"></i>
                                                    <span>Sign In</span>
                                                </>
                                            )}
                                        </button>
                                        
                                        {/* Forgot Password Link */}
                                        <div className="text-center pt-2">
                                            <button
                                                type="button"
                                                onClick={() => {
                                                    setShowForgotPassword(true);
                                                    setForgotEmailError('');
                                                    setForgotEmailSuccess('');
                                                    setForgotEmail('');
                                                }}
                                                className="text-blue-300 hover:text-white text-sm font-medium transition-colors hover:underline"
                                            >
                                                <i className="fas fa-key mr-1"></i>
                                                Forgot Password?
                                            </button>
                                        </div>
                                    </form>
                                ) : (
                                    // Forgot Password Form
                                    <form onSubmit={handleForgotPassword} className="space-y-5">
                                        <div className="text-center mb-6">
                                            <div className="w-16 h-16 bg-gradient-to-br from-yellow-500 to-orange-600 rounded-full flex items-center justify-center mx-auto mb-4">
                                                <i className="fas fa-unlock-alt text-white text-2xl"></i>
                                            </div>
                                            <h2 className="text-xl md:text-2xl font-semibold text-white">Reset Password</h2>
                                            <p className="text-blue-200 text-sm mt-1">Enter your email to receive reset link</p>
                                        </div>
                                        
                                        {forgotEmailError && (
                                            <div className="bg-red-500/20 border border-red-500/50 rounded-xl p-3 flex items-center">
                                                <i className="fas fa-times-circle text-red-400 mr-2"></i>
                                                <span className="text-red-200 text-sm">{forgotEmailError}</span>
                                            </div>
                                        )}
                                        
                                        {forgotEmailSuccess && (
                                            <div className="bg-green-500/20 border border-green-500/50 rounded-xl p-4">
                                                <div className="flex items-start">
                                                    <i className="fas fa-check-circle text-green-400 mr-2 mt-0.5"></i>
                                                    <div className="text-green-200 text-sm">
                                                        <p className="font-semibold">{forgotEmailSuccess}</p>
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                        
                                        {/* Email Input */}
                                        <div className="space-y-2">
                                            <label className="block text-blue-200 text-sm font-medium">Email Address</label>
                                            <div className="relative">
                                                <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                                    <i className="fas fa-envelope text-blue-300"></i>
                                                </div>
                                                <input
                                                    type="email"
                                                    value={forgotEmail}
                                                    onChange={(e) => {
                                                        setForgotEmail(e.target.value);
                                                        setForgotEmailError('');
                                                        setForgotEmailSuccess('');
                                                    }}
                                                    className="login-input w-full pl-12 pr-4 py-3.5 bg-white/10 border border-white/20 rounded-xl text-white placeholder-blue-300 focus:outline-none focus:border-blue-400 focus:bg-white/20 transition-all duration-300"
                                                    placeholder="Enter your registered email"
                                                    required
                                                />
                                            </div>
                                        </div>
                                        
                                        {/* Send Reset Link Button */}
                                        <button
                                            type="submit"
                                            disabled={isSendingReset}
                                            className={`w-full py-3.5 rounded-xl font-semibold text-white transition-all duration-300 transform hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center space-x-2 ${
                                                isSendingReset 
                                                    ? 'bg-yellow-500/50 cursor-not-allowed' 
                                                    : 'bg-gradient-to-r from-yellow-500 to-orange-600 hover:from-yellow-600 hover:to-orange-700 shadow-lg hover:shadow-xl'
                                            }`}
                                        >
                                            {isSendingReset ? (
                                                <>
                                                    <div className="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                                                    <span>Sending...</span>
                                                </>
                                            ) : (
                                                <>
                                                    <i className="fas fa-paper-plane"></i>
                                                    <span>Send Reset Link</span>
                                                </>
                                            )}
                                        </button>
                                        
                                        {/* Back to Login */}
                                        <div className="text-center pt-2">
                                            <button
                                                type="button"
                                                onClick={() => {
                                                    setShowForgotPassword(false);
                                                    setForgotEmailError('');
                                                    setForgotEmailSuccess('');
                                                }}
                                                className="text-blue-300 hover:text-white text-sm font-medium transition-colors hover:underline"
                                            >
                                                <i className="fas fa-arrow-left mr-1"></i>
                                                Back to Login
                                            </button>
                                        </div>
                                    </form>
                                )}
                            </div>
                            
                            {/* Footer */}
                            <div className="mt-8 text-center">
                                <p className="text-blue-300/60 text-xs">
                                    <i className="fas fa-shield-alt mr-1"></i>
                                    Secured with Firebase Authentication
                                </p>
                            </div>
                        </div>
                    </div>
                );
            }

            // =============================================
            // MAIN DASHBOARD UI
            // =============================================
            return (
                <div className="min-h-screen bg-gray-50">
                    {toast && <Toast message={toast.message} type={toast.type} onClose={() => setToast(null)} />}
                    
                    {/* ==================== HEADER ==================== */}
                    <header className="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-40">
                        <div className="w-full max-w-full px-3 sm:px-4 lg:px-6 xl:px-8">
                            <div className="flex justify-between items-center py-3 md:py-4">
                                {/* Logo & Title */}
                                <div className="flex items-center">
                                    <h1 className="text-lg md:text-2xl font-bold text-gray-900">Motioncraft</h1>
                                    <span className="hidden sm:inline-block ml-2 text-xs md:text-sm text-gray-500 bg-gray-100 px-2 py-1 rounded">Dashboard</span>
                                    {notificationCount > 0 && (
                                        <span className="ml-2 bg-red-500 text-white text-xs font-medium px-1.5 py-0.5 rounded-full">
                                            {notificationCount}
                                        </span>
                                    )}
                                </div>
                                
                                {/* Right Side - Sync Status & User Menu */}
                                <div className="flex items-center space-x-2 md:space-x-4">
                                    {/* Sync Status */}
                                    <div className={`sync-indicator sync-${syncStatus}`}>
                                        {syncStatus === 'online' && <><i className="fas fa-cloud mr-1"></i><span className="hidden sm:inline">Online</span></>}
                                        {syncStatus === 'offline' && <><i className="fas fa-cloud-slash mr-1"></i><span className="hidden sm:inline">Offline</span></>}
                                        {syncStatus === 'syncing' && <><i className="fas fa-sync fa-spin mr-1"></i><span className="hidden sm:inline">Syncing</span></>}
                                    </div>
                                    
                                    {/* User Menu */}
                                    <div className="relative">
                                        <button 
                                            onClick={() => setShowUserMenu(!showUserMenu)}
                                            className="flex items-center space-x-2 text-gray-600 hover:text-gray-900 p-2 rounded-lg hover:bg-gray-100"
                                        >
                                            <div className="w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white text-sm font-medium">
                                                {currentUser?.email?.[0]?.toUpperCase() || 'A'}
                                            </div>
                                            <span className="hidden md:inline text-sm font-medium">{currentUser?.displayName || 'Admin'}</span>
                                            <i className="fas fa-chevron-down text-xs hidden md:inline"></i>
                                        </button>
                                        
                                        {showUserMenu && (
                                            <div className="dropdown-menu">
                                                <div className="py-2">
                                                    <div className="px-4 py-2 border-b border-gray-100">
                                                        <p className="text-sm font-medium text-gray-900">{currentUser?.displayName || 'Admin'}</p>
                                                        <p className="text-xs text-gray-500">{currentUser?.email}</p>
                                                    </div>
                                                    <button 
                                                        onClick={() => {
                                                            setActiveTab('settings');
                                                            setShowUserMenu(false);
                                                        }}
                                                        className="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center"
                                                    >
                                                        <i className="fas fa-cog mr-3 text-gray-400"></i> Settings
                                                    </button>
                                                    <button 
                                                        onClick={() => {
                                                            setShowChangePasswordModal(true);
                                                            setShowUserMenu(false);
                                                        }}
                                                        className="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center"
                                                    >
                                                        <i className="fas fa-key mr-3 text-gray-400"></i> Change Password
                                                    </button>
                                                    <hr className="my-1" />
                                                    <button 
                                                        onClick={handleLogout}
                                                        className="w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 flex items-center"
                                                    >
                                                        <i className="fas fa-sign-out-alt mr-3"></i> Logout
                                                    </button>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </header>

                    {/* ==================== DESKTOP NAVIGATION ==================== */}
                    <nav className="bg-white border-b border-gray-200 desktop-nav">
                        <div className="w-full max-w-full px-3 sm:px-4 lg:px-6 xl:px-8">
                            <div className="flex overflow-x-auto hide-scrollbar">
                                <button onClick={() => setActiveTab('overview')} className={`px-4 py-3 font-medium text-sm border-b-2 whitespace-nowrap ${activeTab === 'overview' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700'}`}>
                                    <i className="fas fa-chart-pie mr-2"></i>Overview
                                </button>
                                <button onClick={() => setActiveTab('orders')} className={`px-4 py-3 font-medium text-sm border-b-2 whitespace-nowrap ${activeTab === 'orders' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700'}`}>
                                    <i className="fas fa-clipboard-list mr-2"></i>Orders
                                    {notificationCount > 0 && <span className="ml-1 bg-red-500 text-white text-xs px-1.5 py-0.5 rounded-full">{notificationCount}</span>}
                                </button>
                                <button onClick={() => setActiveTab('team')} className={`px-4 py-3 font-medium text-sm border-b-2 whitespace-nowrap ${activeTab === 'team' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700'}`}>
                                    <i className="fas fa-users mr-2"></i>Team
                                </button>
                                <button onClick={() => setActiveTab('financials')} className={`px-4 py-3 font-medium text-sm border-b-2 whitespace-nowrap ${activeTab === 'financials' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700'}`}>
                                    <i className="fas fa-chart-line mr-2"></i>Financials
                                </button>
                                <button onClick={() => setActiveTab('announcements')} className={`px-4 py-3 font-medium text-sm border-b-2 whitespace-nowrap ${activeTab === 'announcements' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700'}`}>
                                    <i className="fas fa-bullhorn mr-2"></i>Announcements
                                </button>
                                <button onClick={() => setActiveTab('contacts')} className={`px-4 py-3 font-medium text-sm border-b-2 whitespace-nowrap ${activeTab === 'contacts' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700'}`}>
                                    <i className="fas fa-address-book mr-2"></i>Contacts
                                </button>
                                <button onClick={() => setActiveTab('settings')} className={`px-4 py-3 font-medium text-sm border-b-2 whitespace-nowrap ${activeTab === 'settings' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700'}`}>
                                    <i className="fas fa-cog mr-2"></i>Settings
                                </button>
                            </div>
                        </div>
                    </nav>

                    {/* ==================== MAIN CONTENT ==================== */}
                    <main className="w-full max-w-full px-3 sm:px-4 lg:px-6 xl:px-8 py-4 md:py-8 main-content">
                        
                        {/* Overview Tab */}
                        {activeTab === 'overview' && (
                            <div className="w-full">
                                <div className="mb-4 md:mb-8">
                                    <h2 className="text-xl md:text-2xl font-bold text-gray-900">Dashboard Overview</h2>
                                    <p className="text-sm md:text-base text-gray-600">Summary of your business performance</p>
                                </div>

                                {/* Summary Cards */}
                                <div className="grid grid-cols-2 lg:grid-cols-4 gap-3 md:gap-6 mb-6 md:mb-8">
                                    <div className="bg-white rounded-xl shadow-card p-4 md:p-6">
                                        <div className="flex items-center">
                                            <div className="p-2 md:p-3 rounded-lg bg-blue-100 text-blue-600">
                                                <i className="fas fa-clipboard-list text-lg md:text-xl"></i>
                                            </div>
                                            <div className="ml-3 md:ml-4">
                                                <p className="text-xs md:text-sm font-medium text-gray-600">Total Orders</p>
                                                <p className="text-lg md:text-2xl font-bold text-gray-900">{orders.length}</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="bg-white rounded-xl shadow-card p-4 md:p-6">
                                        <div className="flex items-center">
                                            <div className="p-2 md:p-3 rounded-lg bg-green-100 text-green-600">
                                                <i className="fas fa-play-circle text-lg md:text-xl"></i>
                                            </div>
                                            <div className="ml-3 md:ml-4">
                                                <p className="text-xs md:text-sm font-medium text-gray-600">Active</p>
                                                <p className="text-lg md:text-2xl font-bold text-gray-900">{orders.filter(o => o.status !== 'Completed').length}</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="bg-white rounded-xl shadow-card p-4 md:p-6">
                                        <div className="flex items-center">
                                            <div className="p-2 md:p-3 rounded-lg bg-yellow-100 text-yellow-600">
                                                <i className="fas fa-clock text-lg md:text-xl"></i>
                                            </div>
                                            <div className="ml-3 md:ml-4">
                                                <p className="text-xs md:text-sm font-medium text-gray-600">Pending</p>
                                                <p className="text-sm md:text-xl font-bold text-gray-900">{formatCurrency(financials.pendingAmount, CONFIG.DEFAULT_DISPLAY_CURRENCY)}</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="bg-white rounded-xl shadow-card p-4 md:p-6">
                                        <div className="flex items-center">
                                            <div className="p-2 md:p-3 rounded-lg bg-purple-100 text-purple-600">
                                                <i className="fas fa-chart-line text-lg md:text-xl"></i>
                                            </div>
                                            <div className="ml-3 md:ml-4">
                                                <p className="text-xs md:text-sm font-medium text-gray-600">Income</p>
                                                <p className="text-sm md:text-xl font-bold text-gray-900">{formatCurrency(financials.totalIncome, CONFIG.DEFAULT_DISPLAY_CURRENCY)}</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* Recent Orders & Team Workload */}
                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-8">
                                    {/* Recent Orders */}
                                    <div className="bg-white rounded-xl shadow-card p-4 md:p-6">
                                        <div className="flex justify-between items-center mb-4 md:mb-6">
                                            <h3 className="text-base md:text-lg font-semibold text-gray-900">Recent Orders</h3>
                                            <button onClick={() => setActiveTab('orders')} className="text-blue-600 text-xs md:text-sm font-medium">View All</button>
                                        </div>
                                        <div className="space-y-3 md:space-y-4">
                                            {orders.length === 0 ? (
                                                <div className="text-center py-8 text-gray-500">
                                                    <i className="fas fa-inbox text-3xl md:text-4xl mb-4"></i>
                                                    <p className="text-sm md:text-base">No orders yet</p>
                                                </div>
                                            ) : (
                                                orders.slice(0, 5).map(order => (
    <div key={order.id} className={`flex items-center justify-between py-2 border-b border-gray-100 ${isOverdue(order.dueDate) && order.status !== 'Completed' ? 'overdue' : ''}`}>
                                                        <div>
                                                            <p className="font-medium text-gray-900 text-sm md:text-base">{order.id}</p>
                                                            <p className="text-xs md:text-sm text-gray-500">{order.clientName}</p>
                                                        </div>
                                                                                                                <div className="text-right">
                                                            <span className={`inline-block px-2 py-0.5 text-xs rounded-full ${getStatusClass(order.status)}`}>{order.status}</span>
                                                            <p className="text-xs md:text-sm text-gray-500 mt-1">{formatCurrency(order.price, order.currency)}</p>
                                                        </div>
                                                    </div>
                                                ))
                                            )}
                                        </div>
                                    </div>

                                    {/* Team Workload */}
                                    <div className="bg-white rounded-xl shadow-card p-4 md:p-6">
                                        <div className="flex justify-between items-center mb-4 md:mb-6">
                                            <h3 className="text-base md:text-lg font-semibold text-gray-900">Team Workload</h3>
                                            <button onClick={() => setActiveTab('team')} className="text-blue-600 text-xs md:text-sm font-medium">View All</button>
                                        </div>
                                        <div className="space-y-3 md:space-y-4">
                                            {teamWorkload.length === 0 ? (
                                                <div className="text-center py-8 text-gray-500">
                                                    <i className="fas fa-users text-3xl md:text-4xl mb-4"></i>
                                                    <p className="text-sm md:text-base">No team members yet</p>
                                                </div>
                                            ) : (
                                                teamWorkload.map(member => (
                                                    <div key={member.id} className="flex items-center justify-between py-2 border-b border-gray-100">
                                                        <div className="flex items-center">
                                                            <div className="w-8 h-8 md:w-10 md:h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 text-xs md:text-sm font-medium">
                                                                {getInitials(member.name)}
                                                            </div>
                                                            <div className="ml-2 md:ml-3">
                                                                <p className="font-medium text-gray-900 text-sm md:text-base">{member.name}</p>
                                                                <p className="text-xs text-gray-500">{member.role}</p>
                                                            </div>
                                                        </div>
                                                        <div className="text-right">
                                                            <p className="font-medium text-gray-900 text-sm md:text-base">{member.activeProjects} Active</p>
                                                            <p className="text-xs text-gray-500">{member.completedThisMonth} Done</p>
                                                        </div>
                                                    </div>
                                                ))
                                            )}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                        
                        {/* Orders Tab */}
                        {activeTab === 'orders' && (
                            <div className="w-full">
                                <div className="mb-4 md:mb-8">
                                    <div className="flex flex-col sm:flex-row sm:items-center justify-between gap-3">
                                        <div>
                                            <h2 className="text-xl md:text-2xl font-bold text-gray-900">Orders Management</h2>
                                            <p className="text-sm md:text-base text-gray-600">Manage and track all client orders</p>
                                        </div>
                                        <div className="flex flex-wrap gap-2">
                                            <button onClick={exportCSV} className="btn-responsive bg-white border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 flex items-center">
                                                <i className="fas fa-file-csv mr-1 md:mr-2"></i><span className="hidden sm:inline">CSV</span>
                                            </button>
                                            <button onClick={exportPDF} className="btn-responsive bg-white border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 flex items-center">
                                                <i className="fas fa-file-pdf mr-1 md:mr-2"></i><span className="hidden sm:inline">PDF</span>
                                            </button>
                                            <button onClick={printOrders} className="btn-responsive bg-white border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 flex items-center">
                                                <i className="fas fa-print"></i>
                                            </button>
                                            <button onClick={handleCreateOrder} className="btn-responsive bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 flex items-center">
                                                <i className="fas fa-plus mr-1 md:mr-2"></i>New Order
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                {/* Filters */}
                                <div className="bg-white rounded-xl shadow-card p-3 md:p-6 mb-4 md:mb-6">
                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-4">
                                        <div>
                                            <label className="block text-xs md:text-sm font-medium text-gray-700 mb-1">Search</label>
                                            <input
                                                type="text"
                                                value={filters.search}
                                                onChange={(e) => handleFilterChange('search', e.target.value)}
                                                className="w-full px-2 md:px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                                placeholder="ID or Client"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-xs md:text-sm font-medium text-gray-700 mb-1">Status</label>
                                            <select
                                                value={filters.status}
                                                onChange={(e) => handleFilterChange('status', e.target.value)}
                                                className="w-full px-2 md:px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                            >
                                                <option value="">All</option>
                                                <option value="Fresh">Fresh</option>
                                                <option value="Scripting">Scripting</option>
                                                <option value="Editing">Editing</option>
                                                <option value="Correction">Correction</option>
                                                <option value="Final Delivery">Final Delivery</option>
                                                <option value="Completed">Completed</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-xs md:text-sm font-medium text-gray-700 mb-1">Editor</label>
                                            <select
                                                value={filters.editor}
                                                onChange={(e) => handleFilterChange('editor', e.target.value)}
                                                className="w-full px-2 md:px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                            >
                                                <option value="">All</option>
                                                {team.map(member => (
                                                    <option key={member.id} value={member.id}>{member.name}</option>
                                                ))}
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-xs md:text-sm font-medium text-gray-700 mb-1">Payment</label>
                                            <select
                                                value={filters.paymentStatus}
                                                onChange={(e) => handleFilterChange('paymentStatus', e.target.value)}
                                                className="w-full px-2 md:px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                            >
                                                <option value="">All</option>
                                                <option value="Pending">Pending</option>
                                                <option value="Partial">Partial</option>
                                                <option value="Paid">Paid</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                {/* Bulk Actions */}
                                {selectedOrders.length > 0 && (
                                    <div className="bg-blue-50 rounded-xl p-3 md:p-4 mb-4 md:mb-6 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2">
                                        <span className="font-medium text-blue-800 text-sm">{selectedOrders.length} orders selected</span>
                                        <div className="flex flex-wrap gap-2">
                                            <button onClick={() => handleBulkPaymentStatus('Paid')} className="px-2 md:px-3 py-1 bg-green-600 text-white rounded-lg text-xs md:text-sm font-medium">Mark Paid</button>
                                            <button onClick={() => handleBulkPaymentStatus('Pending')} className="px-2 md:px-3 py-1 bg-yellow-600 text-white rounded-lg text-xs md:text-sm font-medium">Mark Pending</button>
                                            <button onClick={() => setSelectedOrders([])} className="px-2 md:px-3 py-1 bg-gray-600 text-white rounded-lg text-xs md:text-sm font-medium">Clear</button>
                                        </div>
                                    </div>
                                )}

                                {/* Mobile Order Cards */}
                                <div className="lg:hidden">
                                    {filteredOrders.length === 0 ? (
                                        <div className="bg-white rounded-xl shadow-card p-8 text-center">
                                            <i className="fas fa-inbox text-4xl text-gray-300 mb-4"></i>
                                            <p className="text-gray-500">No orders found</p>
                                        </div>
                                    ) : (
                                        filteredOrders.map(order => (
                                            <MobileOrderCard
                                                key={order.id}
                                                order={order}
                                                team={team}
                                                onEdit={handleEditOrder}
                                                onPayment={handleAddPayment}
                                                onDelete={handleDeleteOrder}
                                                onStatusChange={updateOrderStatus}
                                                onWhatsApp={openWhatsApp}
                                                onEditBudget={handleEditTeamBudget}
                                            />
                                        ))
                                    )}
                                </div>

                                {/* Desktop Orders Table */}
                                <div className="hidden lg:block bg-white rounded-xl shadow-card overflow-hidden">
                                    <div className="overflow-x-auto">
                                        <table className="min-w-full divide-y divide-gray-200">
                                            <thead className="bg-gray-50">
                                                <tr>
                                                    <th className="px-4 py-3 text-left w-10"><input type="checkbox" className="rounded border-gray-300 text-blue-600" checked={selectedOrders.length === filteredOrders.length && filteredOrders.length > 0} onChange={(e) => e.target.checked ? setSelectedOrders(filteredOrders.map(o => o.id)) : setSelectedOrders([])}/></th>
                                                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Order Info</th>
                                                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Service</th>
                                                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Financials</th>
                                                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Assigned</th>
                                                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Payment</th>
                                                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Method</th>
                                                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody className="bg-white divide-y divide-gray-200">
                                                {filteredOrders.length === 0 ? (
                                                    <tr><td colSpan="9" className="px-6 py-12 text-center text-gray-500">No orders found</td></tr>
                                                ) : (
                                                    filteredOrders.map(order => {
                                                        const teamMember = getTeamMemberById(order.assignedEditor, team);
                                                        const lastPayment = order.paymentHistory?.slice(-1)[0];
                                                        return (
                                                            <tr key={order.id} className={`hover:bg-gray-50 ${order.status === 'Fresh' ? 'new-order' : ''}`}>
                                                                <td className="px-4 py-4"><input type="checkbox" className="rounded border-gray-300 text-blue-600" checked={selectedOrders.includes(order.id)} onChange={() => toggleOrderSelection(order.id)}/></td>
                                                                <td className="px-4 py-4 whitespace-nowrap">
                                                                    <div className="text-sm font-bold text-gray-900">{order.id}</div>
                                                                    <div className="text-xs text-gray-500">{order.clientName}</div>
                                                                </td>
                                                                <td className="px-4 py-4 whitespace-nowrap text-sm text-gray-900">{order.serviceType}</td>
                                                                <td className="px-4 py-4 whitespace-nowrap">
                                                                    <div className="text-sm font-bold text-gray-900">{formatCurrency(order.price, order.currency)}</div>
                                                                    <div className="text-xs text-blue-600 cursor-pointer" onClick={() => handleEditTeamBudget(order)}>
                                                                        Team: {formatCurrency(order.teamBudget || 0, order.currency)} <i className="fas fa-edit"></i>
                                                                    </div>
                                                                </td>
                                                                <td className="px-4 py-4 whitespace-nowrap">
                                                                    <select value={order.assignedEditor || ''} onChange={(e) => assignEditor(order.id, e.target.value)} className="text-xs border rounded px-2 py-1 bg-gray-50">
                                                                        <option value="">Unassigned</option>
                                                                        {team.filter(m => m.active).map(m => <option key={m.id} value={m.id}>{m.name}</option>)}
                                                                    </select>
                                                                </td>
                                                                <td className="px-4 py-4 whitespace-nowrap">
                                                                    <select value={order.status} onChange={(e) => updateOrderStatus(order.id, e.target.value)} className={`text-xs rounded-full px-2 py-1 font-medium ${getStatusClass(order.status)} border-0`}>
                                                                        <option value="Fresh">Fresh</option>
                                                                        <option value="Scripting">Scripting</option>
                                                                        <option value="Editing">Editing</option>
                                                                        <option value="Correction">Correction</option>
                                                                        <option value="Final Delivery">Final Delivery</option>
                                                                        <option value="Completed">Completed</option>
                                                                    </select>
                                                                </td>
                                                                <td className="px-4 py-4 whitespace-nowrap">
                                                                    <span className={`inline-block px-2 py-1 text-xs rounded-full ${getPaymentClass(order.paymentStatus)}`}>{order.paymentStatus}</span>
                                                                    <div className="text-xs text-gray-500 mt-1">Paid: {formatCurrency(order.paidAmount || 0, order.currency)}</div>
                                                                </td>
                                                                <td className="px-4 py-4 whitespace-nowrap text-sm text-gray-600">
                                                                    {lastPayment ? lastPayment.method : '-'}
                                                                </td>
                                                                <td className="px-4 py-4 whitespace-nowrap">
                                                                    <div className="flex space-x-2">
                                                                        <button onClick={() => openWhatsApp(order.clientPhone)} className="text-green-600"><i className="fab fa-whatsapp"></i></button>
                                                                        <button onClick={() => handleEditOrder(order)} className="text-blue-600"><i className="fas fa-edit"></i></button>
                                                                        <button onClick={() => handleAddPayment(order)} className="text-purple-600"><i className="fas fa-money-bill-wave"></i></button>
                                                                        <button onClick={() => handleDeleteOrder(order.id)} className="text-red-600"><i className="fas fa-trash"></i></button>
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                        );
                                                    })
                                                )}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Team Tab */}
                        {activeTab === 'team' && (
                            <div className="w-full">
                                <div className="mb-4 md:mb-8">
                                    <div className="flex flex-col sm:flex-row sm:items-center justify-between gap-3">
                                        <div>
                                            <h2 className="text-xl md:text-2xl font-bold text-gray-900">Team Management</h2>
                                            <p className="text-sm md:text-base text-gray-600">Manage team members, budgets, and workloads</p>
                                        </div>
                                        <button onClick={handleCreateTeamMember} className="btn-responsive bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 flex items-center justify-center sm:justify-start">
                                            <i className="fas fa-plus mr-2"></i>Add Team Member
                                        </button>
                                    </div>
                                </div>

                                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 md:gap-6 mb-6 md:mb-8">
                                    {teamWorkload.length === 0 ? (
                                        <div className="col-span-full bg-white rounded-xl shadow-card p-8 md:p-12 text-center">
                                            <i className="fas fa-users text-4xl text-gray-300 mb-4"></i>
                                            <p className="text-gray-500">No team members yet</p>
                                            <button onClick={handleCreateTeamMember} className="mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium">
                                                <i className="fas fa-plus mr-2"></i>Add First Member
                                            </button>
                                        </div>
                                    ) : (
                                        teamWorkload.map(member => (
                                            <MobileTeamCard
                                                key={member.id}
                                                member={member}
                                                onEdit={handleEditTeamMember}
                                                onDelete={handleDeleteTeamMember}
                                                onWhatsApp={openWhatsApp}
                                            />
                                        ))
                                    )}
                                </div>

                                {/* Team & Project Details Table */}
                                <div className="mt-6 bg-white rounded-xl shadow-card overflow-hidden">
                                    <div className="px-6 py-4 border-b border-gray-200 flex justify-between items-center bg-gray-50">
                                        <h3 className="text-lg font-bold text-gray-900">Assigned Projects & Team Payment</h3>
                                    </div>
                                    <div className="overflow-x-auto">
                                        <table className="min-w-full divide-y divide-gray-200">
                                            <thead className="bg-gray-100">
                                                <tr>
                                                    <th className="px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase">Project Info</th>
                                                    <th className="px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase">Editor</th>
                                                    <th className="px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase">Budget</th>
                                                    <th className="px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase">Payment Status</th>
                                                    <th className="px-6 py-3 text-right text-xs font-bold text-gray-600 uppercase">Action</th>
                                                </tr>
                                            </thead>
                                            <tbody className="bg-white divide-y divide-gray-200">
                                                {orders.filter(o => o.assignedEditor && o.status !== 'Completed').length === 0 ? (
                                                    <tr><td colSpan="5" className="px-6 py-8 text-center text-gray-500">No active assigned projects.</td></tr>
                                                ) : (
                                                    orders.filter(o => o.assignedEditor && o.status !== 'Completed').map(order => {
                                                        const member = getTeamMemberById(order.assignedEditor, team);
                                                        const teamPaid = order.teamPaidAmount || 0;
                                                        const teamStatus = order.teamPaymentStatus || 'Pending';
                                                        const budget = order.teamBudget || 0;
                                                        
                                                        return (
                                                            <tr key={order.id} className="hover:bg-gray-50">
                                                                <td className="px-6 py-4 whitespace-nowrap">
                                                                    <div className="font-bold text-gray-900">{order.id}</div>
                                                                    <div className="text-xs text-gray-500">{order.clientName}</div>
                                                                </td>
                                                                <td className="px-6 py-4 whitespace-nowrap">
                                                                    <div className="flex items-center">
                                                                        <div className="w-6 h-6 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 text-xs font-bold mr-2">
                                                                            {getInitials(member.name)}
                                                                        </div>
                                                                        <span className="text-sm font-medium">{member.name}</span>
                                                                    </div>
                                                                </td>
                                                                <td className="px-6 py-4 whitespace-nowrap text-blue-600 font-bold">
                                                                    {formatCurrency(budget, order.currency)}
                                                                </td>
                                                                <td className="px-6 py-4 whitespace-nowrap">
                                                                    <span className={`px-2 py-1 text-xs rounded-full font-bold ${
                                                                        teamStatus === 'Paid' ? 'bg-green-100 text-green-800' :
                                                                        teamStatus === 'Partial' ? 'bg-yellow-100 text-yellow-800' :
                                                                        'bg-red-100 text-red-800'
                                                                    }`}>
                                                                        {teamStatus}
                                                                    </span>
                                                                    <div className="text-xs text-gray-500 mt-1 font-medium">
                                                                        Paid: {formatCurrency(teamPaid, order.currency)}
                                                                    </div>
                                                                </td>
                                                                <td className="px-6 py-4 whitespace-nowrap text-right">
                                                                    <button 
                                                                        onClick={() => handleOpenTeamPayment(order)}
                                                                        className="inline-flex items-center px-4 py-2 border border-transparent text-xs font-bold rounded-lg text-white bg-blue-600 hover:bg-blue-700 shadow-sm transition-all"
                                                                    >
                                                                        <i className="fas fa-hand-holding-usd mr-2"></i> Pay
                                                                    </button>
                                                                </td>
                                                            </tr>
                                                        );
                                                    })
                                                )}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Financials Tab */}
                        {activeTab === 'financials' && (
                            <div className="w-full">
                                <div className="mb-4 md:mb-8">
                                    <div className="flex flex-col sm:flex-row sm:items-center justify-between gap-3">
                                        <div>
                                            <h2 className="text-xl md:text-2xl font-bold text-gray-900">Financial Overview</h2>
                                            <p className="text-sm md:text-base text-gray-600">Track income, expenses, and profits</p>
                                        </div>
                                        <div>
                                            <input
                                                type="month"
                                                value={selectedMonth}
                                                onChange={(e) => setSelectedMonth(e.target.value)}
                                                className="px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                            />
                                        </div>
                                    </div>
                                </div>

                                {/* Financial Summary Cards */}
                                <div className="grid grid-cols-2 lg:grid-cols-4 gap-3 md:gap-6 mb-6 md:mb-8">
                                    <div className="bg-white rounded-xl shadow-card p-4 md:p-6">
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <p className="text-xs md:text-sm font-medium text-gray-600">Total Income</p>
                                                <p className="text-lg md:text-2xl font-bold text-green-600">{formatCurrency(financials.totalIncome, CONFIG.DEFAULT_DISPLAY_CURRENCY)}</p>
                                            </div>
                                            <div className="p-2 md:p-3 rounded-lg bg-green-100 text-green-600">
                                                <i className="fas fa-arrow-up text-lg md:text-xl"></i>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="bg-white rounded-xl shadow-card p-4 md:p-6">
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <p className="text-xs md:text-sm font-medium text-gray-600">Expenses</p>
                                                <p className="text-lg md:text-2xl font-bold text-red-600">{formatCurrency(financials.totalExpenses, CONFIG.DEFAULT_DISPLAY_CURRENCY)}</p>
                                            </div>
                                            <div className="p-2 md:p-3 rounded-lg bg-red-100 text-red-600">
                                                <i className="fas fa-arrow-down text-lg md:text-xl"></i>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="bg-white rounded-xl shadow-card p-4 md:p-6">
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <p className="text-xs md:text-sm font-medium text-gray-600">Net Profit</p>
                                                <p className="text-lg md:text-2xl font-bold text-blue-600">{formatCurrency(financials.netProfit, CONFIG.DEFAULT_DISPLAY_CURRENCY)}</p>
                                            </div>
                                            <div className="p-2 md:p-3 rounded-lg bg-blue-100 text-blue-600">
                                                <i className="fas fa-chart-line text-lg md:text-xl"></i>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="bg-white rounded-xl shadow-card p-4 md:p-6">
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <p className="text-xs md:text-sm font-medium text-gray-600">Pending</p>
                                                <p className="text-lg md:text-2xl font-bold text-yellow-600">{formatCurrency(financials.pendingAmount, CONFIG.DEFAULT_DISPLAY_CURRENCY)}</p>
                                            </div>
                                            <div className="p-2 md:p-3 rounded-lg bg-yellow-100 text-yellow-600">
                                                <i className="fas fa-clock text-lg md:text-xl"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* Currency Info */}
                                <div className="bg-white rounded-xl shadow-card p-4 md:p-6 mb-4 md:mb-6">
                                    <h3 className="text-base md:text-lg font-semibold text-gray-900 mb-4">Currency Information</h3>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <p className="text-xs md:text-sm text-gray-600">Default Currency</p>
                                            <p className="text-base md:text-lg font-medium text-gray-900">{CONFIG.DEFAULT_DISPLAY_CURRENCY}</p>
                                        </div>
                                        <div>
                                            <p className="text-xs md:text-sm text-gray-600">Exchange Rate (BDT/USD)</p>
                                            <p className="text-base md:text-lg font-medium text-gray-900">{CONFIG.EXCHANGE_RATE_BDT_PER_USD}</p>
                                        </div>
                                    </div>
                                </div>

                                {/* Export Options */}
                                <div className="bg-white rounded-xl shadow-card p-4 md:p-6">
                                    <h3 className="text-base md:text-lg font-semibold text-gray-900 mb-4">Export Financial Data</h3>
                                    <div className="flex flex-wrap gap-2 md:gap-4">
                                        <button onClick={exportCSV} className="px-3 md:px-4 py-2 bg-green-600 text-white rounded-lg text-sm font-medium hover:bg-green-700 flex items-center">
                                            <i className="fas fa-file-csv mr-2"></i>Export CSV
                                        </button>
                                        <button onClick={exportPDF} className="px-3 md:px-4 py-2 bg-red-600 text-white rounded-lg text-sm font-medium hover:bg-red-700 flex items-center">
                                            <i className="fas fa-file-pdf mr-2"></i>Export PDF
                                        </button>
                                        <button onClick={printOrders} className="px-3 md:px-4 py-2 bg-gray-600 text-white rounded-lg text-sm font-medium hover:bg-gray-700 flex items-center">
                                            <i className="fas fa-print mr-2"></i>Print
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Announcements Tab */}
                        {activeTab === 'announcements' && (
                            <div className="w-full">
                                <div className="mb-4 md:mb-8">
                                    <div className="flex flex-col sm:flex-row sm:items-center justify-between gap-3">
                                        <div>
                                            <h2 className="text-xl md:text-2xl font-bold text-gray-900">Announcement Board</h2>
                                            <p className="text-sm md:text-base text-gray-600">Set targets, missions, dreams, and reminders</p>
                                        </div>
                                        <button onClick={handleCreateAnnouncement} className="btn-responsive bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 flex items-center justify-center sm:justify-start">
                                            <i className="fas fa-plus mr-2"></i>New Note
                                        </button>
                                    </div>
                                </div>

                                {/* Category Filters */}
                                <div className="bg-white rounded-xl shadow-card p-3 md:p-6 mb-4 md:mb-6">
                                    <div className="flex flex-wrap gap-2">
                                        {['all', 'target', 'mission', 'dream', 'reminder', 'idea', 'general'].map(cat => (
                                            <button
                                                key={cat}
                                                onClick={() => setAnnouncementFilter(cat)}
                                                className={`px-3 py-1 rounded-full text-xs md:text-sm font-medium transition ${
                                                    announcementFilter === cat 
                                                        ? 'bg-blue-600 text-white' 
                                                        : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                                }`}
                                            >
                                                {cat.charAt(0).toUpperCase() + cat.slice(1)}
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                {/* Sticky Notes Grid */}
                                <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 md:gap-6">
                                    {filteredAnnouncements.length === 0 ? (
                                        <div className="col-span-full bg-white rounded-xl shadow-card p-8 md:p-12 text-center">
                                            <i className="fas fa-sticky-note text-4xl text-gray-300 mb-4"></i>
                                            <p className="text-gray-500 mb-4">No announcements yet</p>
                                            <button onClick={handleCreateAnnouncement} className="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium">
                                                <i className="fas fa-plus mr-2"></i>Create First Note
                                            </button>
                                        </div>
                                    ) : (
                                        filteredAnnouncements.map(announcement => (
                                            <div key={announcement.id} className={`sticky-note sticky-note-${announcement.color} rounded-lg p-4 relative`}>
                                                <div className="pin"></div>
                                                <div className="flex justify-between items-start mb-2">
                                                    <h3 className="font-bold text-base md:text-lg note-content pr-8">{announcement.title}</h3>
                                                    <div className="flex space-x-1 absolute top-3 right-3">
                                                        <button onClick={() => handleEditAnnouncement(announcement)} className="text-gray-600 hover:text-gray-900 p-1">
                                                            <i className="fas fa-edit text-xs"></i>
                                                        </button>
                                                        <button onClick={() => handleDeleteAnnouncement(announcement.id)} className="text-gray-600 hover:text-red-600 p-1">
                                                            <i className="fas fa-trash text-xs"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                                <div className="note-content text-sm md:text-base mb-4 text-gray-700 whitespace-pre-wrap break-words">
                                                    {announcement.content}
                                                </div>
                                                <div className="flex justify-between items-center mt-auto">
                                                    <span className={`category-tag ${getCategoryColor(announcement.category)}`}>
                                                        {announcement.category}
                                                    </span>
                                                    <div className="flex items-center">
                                                        <div className={`w-2 h-2 rounded-full ${getPriorityColor(announcement.priority)} mr-1`}></div>
                                                        <span className="text-xs text-gray-500">{announcement.priority}</span>
                                                    </div>
                                                </div>
                                                <div className="text-xs text-gray-500 mt-2 text-right">{announcement.createdAt}</div>
                                            </div>
                                        ))
                                    )}
                                </div>
                            </div>
                        )}

                        {/* Contacts Tab */}
                        {activeTab === 'contacts' && (
                            <div className="w-full">
                                <div className="mb-4 md:mb-8">
                                    <div className="flex flex-col sm:flex-row sm:items-center justify-between gap-3">
                                        <div>
                                            <h2 className="text-xl md:text-2xl font-bold text-gray-900">Contacts</h2>
                                            <p className="text-sm md:text-base text-gray-600">Manage client and team contacts</p>
                                        </div>
                                        <button onClick={handleCreateContact} className="btn-responsive bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 flex items-center justify-center sm:justify-start">
                                            <i className="fas fa-plus mr-2"></i>Add Contact
                                        </button>
                                    </div>
                                </div>

                                {/* Mobile Contact Cards */}
                                <div className="md:hidden">
                                    {contacts.length === 0 ? (
                                        <div className="bg-white rounded-xl shadow-card p-8 text-center">
                                            <i className="fas fa-address-book text-4xl text-gray-300 mb-4"></i>
                                            <p className="text-gray-500">No contacts yet</p>
                                        </div>
                                    ) : (
                                        contacts.map(contact => (
                                            <MobileContactCard
                                                key={contact.id}
                                                contact={contact}
                                                onEdit={handleEditContact}
                                                onDelete={handleDeleteContact}
                                                onWhatsApp={openWhatsApp}
                                            />
                                        ))
                                    )}
                                </div>

                                {/* Desktop Contacts Table */}
                                <div className="hidden md:block bg-white rounded-xl shadow-card overflow-hidden">
                                    <div className="overflow-x-auto">
                                        <table className="min-w-full divide-y divide-gray-200">
                                            <thead className="bg-gray-50">
                                                <tr>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Name</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Phone</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Email</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Type</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody className="bg-white divide-y divide-gray-200">
                                                {contacts.length === 0 ? (
                                                    <tr>
                                                        <td colSpan="5" className="px-6 py-12 text-center text-gray-500">
                                                            <i className="fas fa-address-book text-4xl mb-4"></i>
                                                            <p>No contacts yet</p>
                                                        </td>
                                                    </tr>
                                                ) : (
                                                    contacts.map(contact => (
                                                        <tr key={contact.id} className="hover:bg-gray-50">
                                                            <td className="px-6 py-4 whitespace-nowrap">
                                                                <div className="flex items-center">
                                                                    <div className="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center text-gray-600 font-medium">
                                                                        {getInitials(contact.name)}
                                                                    </div>
                                                                    <div className="ml-3">
                                                                        <div className="text-sm font-medium text-gray-900">{contact.name}</div>
                                                                    </div>
                                                                </div>
                                                            </td>
                                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{contact.phone}</td>
                                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{contact.email || '-'}</td>
                                                            <td className="px-6 py-4 whitespace-nowrap">
                                                                <span className="px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800">{contact.type}</span>
                                                            </td>
                                                            <td className="px-6 py-4 whitespace-nowrap">
                                                                <div className="flex space-x-3">
                                                                    <button onClick={() => openWhatsApp(contact.phone)} className="text-green-600 hover:text-green-900">
                                                                        <i className="fab fa-whatsapp"></i>
                                                                    </button>
                                                                    <button onClick={() => handleEditContact(contact)} className="text-blue-600 hover:text-blue-900">
                                                                        <i className="fas fa-edit"></i>
                                                                    </button>
                                                                    <button onClick={() => handleDeleteContact(contact.id)} className="text-red-600 hover:text-red-900">
                                                                        <i className="fas fa-trash"></i>
                                                                    </button>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                    ))
                                                )}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        )}

                                                {/* ==================== SETTINGS TAB (ROLE-BASED ACCESS) ==================== */}
                        {activeTab === 'settings' && (
                            <div className="w-full">
                                <div className="mb-4 md:mb-8">
                                    <h2 className="text-xl md:text-2xl font-bold text-gray-900">Settings</h2>
                                    <p className="text-sm md:text-base text-gray-600">
                                        {isOriginalAdmin() ? 'Manage admins, security, and view activity logs' : 'Manage your account settings'}
                                    </p>
                                </div>

                                {/* Current User Info Card - Visible to All */}
                                <div className="bg-white rounded-xl shadow-card p-4 md:p-6 mb-6">
                                    <div className="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
                                        <div className="flex items-center">
                                            <div className="w-12 h-12 md:w-14 md:h-14 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold text-lg md:text-xl">
                                                {currentUser?.email?.[0]?.toUpperCase() || 'A'}
                                            </div>
                                            <div className="ml-3 md:ml-4">
                                                <p className="font-bold text-gray-900 text-base md:text-lg">{currentUser?.displayName || 'Admin'}</p>
                                                <p className="text-xs md:text-sm text-gray-500">{currentUser?.email}</p>
                                                <span className={`inline-block mt-1 px-2 py-0.5 text-xs rounded-full font-medium ${
                                                    isOriginalAdmin() ? 'bg-purple-100 text-purple-800' : 'bg-blue-100 text-blue-800'
                                                }`}>
                                                    {isOriginalAdmin() ? ' Original Admin' : ` ${getCurrentUserRole()}`}
                                                </span>
                                            </div>
                                        </div>
                                        <button 
                                            onClick={() => setShowChangePasswordModal(true)}
                                            className="w-full sm:w-auto px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 flex items-center justify-center text-sm md:text-base"
                                        >
                                            <i className="fas fa-key mr-2"></i>Change Password
                                        </button>
                                    </div>
                                </div>

                                {/* ========== ORIGINAL ADMIN ONLY SECTIONS ========== */}
                                {isOriginalAdmin() ? (
                                    <>
                                        {/* Admin Management Section */}
                                        <div className="bg-white rounded-xl shadow-card overflow-hidden mb-6">
                                            <div className="px-4 md:px-6 py-3 md:py-4 border-b border-gray-200 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 bg-gradient-to-r from-blue-50 to-purple-50">
                                                <div>
                                                    <h3 className="text-base md:text-lg font-bold text-gray-900 flex items-center">
                                                        <i className="fas fa-user-shield mr-2 text-blue-600"></i>
                                                        Admin Management
                                                    </h3>
                                                    <p className="text-xs md:text-sm text-gray-600">Add, manage, block or remove admins</p>
                                                </div>
                                                <button 
                                                    onClick={handleCreateAdmin}
                                                    className="w-full sm:w-auto px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 flex items-center justify-center text-sm"
                                                >
                                                    <i className="fas fa-plus mr-2"></i>Add Admin
                                                </button>
                                            </div>

                                            {/* Admins List */}
                                            <div className="divide-y divide-gray-100">
                                                {admins.length === 0 ? (
                                                    <div className="px-6 py-8 md:py-12 text-center">
                                                        <i className="fas fa-users-cog text-4xl text-gray-300 mb-3 md:mb-4"></i>
                                                        <p className="text-gray-500 mb-4 text-sm md:text-base">No additional admins yet</p>
                                                        <button 
                                                            onClick={handleCreateAdmin}
                                                            className="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700"
                                                        >
                                                            <i className="fas fa-plus mr-2"></i>Add First Admin
                                                        </button>
                                                    </div>
                                                ) : (
                                                    admins.map(admin => (
                                                        <div key={admin.id} className={`px-4 md:px-6 py-3 md:py-4 ${admin.status === 'blocked' ? 'bg-red-50' : 'hover:bg-gray-50'}`}>
                                                            <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3">
                                                                {/* Admin Info */}
                                                                <div className="flex items-center">
                                                                    <div className={`w-9 h-9 md:w-10 md:h-10 rounded-full flex items-center justify-center font-bold text-sm ${
                                                                        admin.status === 'blocked' 
                                                                            ? 'bg-red-100 text-red-600' 
                                                                            : 'bg-gradient-to-br from-green-400 to-blue-500 text-white'
                                                                    }`}>
                                                                        {admin.name?.[0]?.toUpperCase() || 'A'}
                                                                    </div>
                                                                    <div className="ml-3">
                                                                        <p className="font-medium text-gray-900 text-sm md:text-base">{admin.name}</p>
                                                                        <p className="text-xs md:text-sm text-gray-500">{admin.email}</p>
                                                                        <div className="flex items-center gap-1.5 mt-1 flex-wrap">
                                                                            <span className={`px-1.5 py-0.5 text-xs rounded-full font-medium ${
                                                                                admin.status === 'blocked' 
                                                                                    ? 'bg-red-100 text-red-700' 
                                                                                    : 'bg-green-100 text-green-700'
                                                                            }`}>
                                                                                {admin.status === 'blocked' ? ' Blocked' : ' Active'}
                                                                            </span>
                                                                            <span className="px-1.5 py-0.5 text-xs rounded-full bg-gray-100 text-gray-600">
                                                                                {admin.role}
                                                                            </span>
                                                                            <span className="text-xs text-gray-400 hidden sm:inline">
                                                                                Added: {admin.createdAt}
                                                                            </span>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                
                                                                {/* Action Buttons */}
                                                                <div className="flex items-center gap-1.5 flex-wrap w-full sm:w-auto">
                                                                    <button 
                                                                        onClick={() => handleEditAdmin(admin)}
                                                                        className="px-2 py-1 text-xs bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100"
                                                                    >
                                                                        <i className="fas fa-edit mr-1"></i>Edit
                                                                    </button>
                                                                    <button 
                                                                        onClick={() => handleSendPasswordReset(admin.email, admin.name)}
                                                                        className="px-2 py-1 text-xs bg-purple-50 text-purple-600 rounded-lg hover:bg-purple-100"
                                                                    >
                                                                        <i className="fas fa-key mr-1"></i>Reset
                                                                    </button>
                                                                    <button 
                                                                        onClick={() => handleBlockAdmin(admin)}
                                                                        className={`px-2 py-1 text-xs rounded-lg ${
                                                                            admin.status === 'blocked'
                                                                                ? 'bg-green-50 text-green-600 hover:bg-green-100'
                                                                                : 'bg-yellow-50 text-yellow-600 hover:bg-yellow-100'
                                                                        }`}
                                                                    >
                                                                        <i className={`fas ${admin.status === 'blocked' ? 'fa-unlock' : 'fa-ban'} mr-1`}></i>
                                                                        {admin.status === 'blocked' ? 'Unblock' : 'Block'}
                                                                    </button>
                                                                    <button 
                                                                        onClick={() => handleDeleteAdmin(admin.id, admin.email, admin.name)}
                                                                        className="px-2 py-1 text-xs bg-red-50 text-red-600 rounded-lg hover:bg-red-100"
                                                                    >
                                                                        <i className="fas fa-trash mr-1"></i>Delete
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    ))
                                                )}
                                            </div>
                                        </div>

                                        {/* Activity History Section - ONLY FOR ORIGINAL ADMIN */}
                                        <div className="bg-white rounded-xl shadow-card overflow-hidden mb-6">
                                            <div className="px-4 md:px-6 py-3 md:py-4 border-b border-gray-200 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 bg-gradient-to-r from-orange-50 to-red-50">
                                                <div>
                                                    <h3 className="text-base md:text-lg font-bold text-gray-900 flex items-center">
                                                        <i className="fas fa-history mr-2 text-orange-600"></i>
                                                        Admin Activity History
                                                    </h3>
                                                    <p className="text-xs md:text-sm text-gray-600">Track all admin actions for security</p>
                                                </div>
                                                <button 
                                                    onClick={() => setShowActivityLogModal(true)}
                                                    className="w-full sm:w-auto px-4 py-2 bg-orange-600 text-white rounded-lg font-medium hover:bg-orange-700 flex items-center justify-center text-sm"
                                                >
                                                    <i className="fas fa-list mr-2"></i>View All
                                                </button>
                                            </div>

                                            {/* Recent Activities Preview */}
                                            <div className="divide-y divide-gray-100">
                                                {activityLogs.length === 0 ? (
                                                    <div className="px-6 py-8 text-center">
                                                        <i className="fas fa-clipboard-list text-4xl text-gray-300 mb-3"></i>
                                                        <p className="text-gray-500 text-sm md:text-base">No activity recorded yet</p>
                                                        <p className="text-gray-400 text-xs mt-1">Activities will appear here as admins make changes</p>
                                                    </div>
                                                ) : (
                                                    activityLogs.slice(0, 5).map(log => (
                                                        <div key={log.id} className="px-4 md:px-6 py-3 hover:bg-gray-50">
                                                            <div className="flex items-start gap-3">
                                                                {/* Icon */}
                                                                <div className={`w-8 h-8 rounded-full flex items-center justify-center text-white text-xs flex-shrink-0 ${
                                                                    log.action.includes('DELETE') ? 'bg-red-500' :
                                                                    log.action.includes('BLOCK') ? 'bg-yellow-500' :
                                                                    log.action.includes('UNBLOCK') ? 'bg-green-500' :
                                                                    log.action.includes('CREATE') || log.action.includes('ADD') ? 'bg-green-500' :
                                                                    log.action.includes('PAYMENT') ? 'bg-purple-500' :
                                                                    log.action.includes('STATUS') ? 'bg-blue-500' :
                                                                    'bg-gray-500'
                                                                }`}>
                                                                    <i className={`fas ${
                                                                        log.action.includes('DELETE') ? 'fa-trash' :
                                                                        log.action.includes('BLOCK') ? 'fa-ban' :
                                                                        log.action.includes('UNBLOCK') ? 'fa-unlock' :
                                                                        log.action.includes('CREATE') || log.action.includes('ADD') ? 'fa-plus' :
                                                                        log.action.includes('PAYMENT') ? 'fa-money-bill' :
                                                                        log.action.includes('STATUS') ? 'fa-sync' :
                                                                        'fa-edit'
                                                                    } text-xs`}></i>
                                                                </div>
                                                                
                                                                {/* Details */}
                                                                <div className="flex-1 min-w-0">
                                                                    <p className="text-sm font-medium text-gray-900 truncate">{log.details}</p>
                                                                    <p className="text-xs text-gray-500">
                                                                        By: {log.performedBy?.name || log.performedBy?.email}
                                                                    </p>
                                                                </div>
                                                                
                                                                {/* Time */}
                                                                <div className="text-right flex-shrink-0">
                                                                    <p className="text-xs text-gray-500">{log.date}</p>
                                                                    <p className="text-xs text-gray-400">{log.time}</p>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    ))
                                                )}
                                            </div>
                                            
                                            {/* View More Link */}
                                            {activityLogs.length > 5 && (
                                                <div className="px-4 md:px-6 py-3 bg-gray-50 border-t border-gray-100">
                                                    <button 
                                                        onClick={() => setShowActivityLogModal(true)}
                                                        className="text-sm text-blue-600 hover:text-blue-800 font-medium"
                                                    >
                                                        <i className="fas fa-arrow-right mr-1"></i>
                                                        View all {activityLogs.length} activities
                                                    </button>
                                                </div>
                                            )}
                                        </div>
                                    </>
                                ) : (
                                    /* ========== LIMITED ACCESS FOR SUB ADMINS ========== */
                                    <div className="bg-yellow-50 border-2 border-yellow-200 rounded-xl p-4 md:p-6 mb-6">
                                        <div className="flex flex-col sm:flex-row items-start gap-4">
                                            <div className="w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center text-yellow-600 flex-shrink-0">
                                                <i className="fas fa-exclamation-triangle text-xl"></i>
                                            </div>
                                            <div className="flex-1">
                                                <h3 className="font-bold text-yellow-800 text-base md:text-lg">Limited Access</h3>
                                                <p className="text-yellow-700 text-sm mt-1">
                                                    As a <strong>{getCurrentUserRole()}</strong>, you can only change your own password. 
                                                    Admin management and activity history are restricted to the Original Admin.
                                                </p>
                                                
                                                {/* What you can/cannot do */}
                                                <div className="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-3">
                                                    <div className="bg-green-50 rounded-lg p-3 border border-green-200">
                                                        <h4 className="font-semibold text-green-800 text-sm flex items-center mb-2">
                                                            <i className="fas fa-check-circle mr-2"></i>You Can:
                                                        </h4>
                                                        <ul className="text-xs text-green-700 space-y-1">
                                                            <li><i className="fas fa-check mr-1.5 text-green-500"></i>Change your password</li>
                                                            <li><i className="fas fa-check mr-1.5 text-green-500"></i>View & manage orders</li>
                                                            <li><i className="fas fa-check mr-1.5 text-green-500"></i>Manage team members</li>
                                                            <li><i className="fas fa-check mr-1.5 text-green-500"></i>Manage contacts</li>
                                                            <li><i className="fas fa-check mr-1.5 text-green-500"></i>Create announcements</li>
                                                        </ul>
                                                    </div>
                                                    <div className="bg-red-50 rounded-lg p-3 border border-red-200">
                                                        <h4 className="font-semibold text-red-800 text-sm flex items-center mb-2">
                                                            <i className="fas fa-times-circle mr-2"></i>Restricted:
                                                        </h4>
                                                        <ul className="text-xs text-red-700 space-y-1">
                                                            <li><i className="fas fa-times mr-1.5 text-red-500"></i>Add new admins</li>
                                                            <li><i className="fas fa-times mr-1.5 text-red-500"></i>Edit other admins</li>
                                                            <li><i className="fas fa-times mr-1.5 text-red-500"></i>Block/Unblock admins</li>
                                                            <li><i className="fas fa-times mr-1.5 text-red-500"></i>Delete admins</li>
                                                            <li><i className="fas fa-times mr-1.5 text-red-500"></i>View activity history</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                
                                                {/* Contact Admin */}
                                                <div className="mt-4 p-3 bg-blue-50 rounded-lg border border-blue-200">
                                                    <p className="text-xs text-blue-700">
                                                        <i className="fas fa-info-circle mr-1.5"></i>
                                                        Need more access? Contact the Original Admin at <strong>{CONFIG.DEFAULT_ADMIN_EMAIL}</strong>
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* App Info - Visible to All */}
                                <div className="bg-white rounded-xl shadow-card p-4 md:p-6">
                                    <h3 className="text-base md:text-lg font-bold text-gray-900 mb-4 flex items-center">
                                        <i className="fas fa-info-circle mr-2 text-blue-600"></i>
                                        App Information
                                    </h3>
                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4">
                                        <div className="bg-gray-50 p-3 md:p-4 rounded-lg">
                                            <p className="text-xs text-gray-500">Version</p>
                                            <p className="font-semibold text-gray-900 text-sm md:text-base">2.0.0</p>
                                        </div>
                                        <div className="bg-gray-50 p-3 md:p-4 rounded-lg">
                                            <p className="text-xs text-gray-500">Database</p>
                                            <p className="font-semibold text-gray-900 text-sm md:text-base">Firebase</p>
                                        </div>
                                        <div className="bg-gray-50 p-3 md:p-4 rounded-lg">
                                            <p className="text-xs text-gray-500">Currency</p>
                                            <p className="font-semibold text-gray-900 text-sm md:text-base">{CONFIG.DEFAULT_DISPLAY_CURRENCY}</p>
                                        </div>
                                        <div className="bg-gray-50 p-3 md:p-4 rounded-lg">
                                            <p className="text-xs text-gray-500">Your Role</p>
                                            <p className="font-semibold text-gray-900 text-sm md:text-base">
                                                {isOriginalAdmin() ? 'Original Admin' : getCurrentUserRole()}
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>

                    {/* Spacer for mobile navigation */}
                    <div className="h-20 md:h-0"></div>
                    
                                        {/* ==================== MOBILE BOTTOM NAVIGATION ==================== */}
                    <nav className="mobile-nav">
                        <div className="flex justify-around py-2">
                            <button onClick={() => setActiveTab('overview')} className={`flex flex-col items-center py-1 px-2 ${activeTab === 'overview' ? 'text-blue-600' : 'text-gray-500'}`}>
                                <i className="fas fa-chart-pie text-lg"></i>
                                <span className="text-xs mt-1">Overview</span>
                            </button>
                            <button onClick={() => setActiveTab('orders')} className={`flex flex-col items-center py-1 px-2 relative ${activeTab === 'orders' ? 'text-blue-600' : 'text-gray-500'}`}>
                                <i className="fas fa-clipboard-list text-lg"></i>
                                <span className="text-xs mt-1">Orders</span>
                                {notificationCount > 0 && (
                                    <span className="absolute -top-1 right-0 bg-red-500 text-white text-xs w-4 h-4 rounded-full flex items-center justify-center">{notificationCount}</span>
                                )}
                            </button>
                            <button onClick={() => setActiveTab('team')} className={`flex flex-col items-center py-1 px-2 ${activeTab === 'team' ? 'text-blue-600' : 'text-gray-500'}`}>
                                <i className="fas fa-users text-lg"></i>
                                <span className="text-xs mt-1">Team</span>
                            </button>
                            <button onClick={() => setActiveTab('financials')} className={`flex flex-col items-center py-1 px-2 ${activeTab === 'financials' ? 'text-blue-600' : 'text-gray-500'}`}>
                                <i className="fas fa-chart-line text-lg"></i>
                                <span className="text-xs mt-1">Finance</span>
                            </button>
                            <button onClick={() => setActiveTab('announcements')} className={`flex flex-col items-center py-1 px-2 ${activeTab === 'announcements' ? 'text-blue-600' : 'text-gray-500'}`}>
                                <i className="fas fa-bullhorn text-lg"></i>
                                <span className="text-xs mt-1">Notes</span>
                            </button>
                            <button onClick={() => setActiveTab('settings')} className={`flex flex-col items-center py-1 px-2 ${activeTab === 'settings' ? 'text-blue-600' : 'text-gray-500'}`}>
                                <i className="fas fa-cog text-lg"></i>
                                <span className="text-xs mt-1">Settings</span>
                            </button>
                        </div>
                    </nav>

                    {/* ==================== ORDER MODAL ==================== */}
                    {showOrderModal && currentOrder && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-3 md:p-4 z-50">
                            <div className="bg-white rounded-xl shadow-card w-full max-w-2xl modal-content">
                                <div className="p-4 md:p-6 border-b border-gray-200">
                                    <div className="flex justify-between items-center">
                                        <h3 className="text-lg font-semibold text-gray-900">
                                            {orders.find(o => o.id === currentOrder.id) ? 'Edit Order' : 'Create New Order'}
                                        </h3>
                                        <button onClick={() => setShowOrderModal(false)} className="text-gray-400 hover:text-gray-600">
                                            <i className="fas fa-times text-xl"></i>
                                        </button>
                                    </div>
                                </div>
                                <div className="p-4 md:p-6">
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Order ID</label>
                                            <input type="text" value={currentOrder.id} disabled className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg bg-gray-100" />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Client Name *</label>
                                            <input type="text" value={currentOrder.clientName} onChange={(e) => setCurrentOrder({...currentOrder, clientName: e.target.value})} className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Enter client name" />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Client Phone *</label>
                                            <input type="text" value={currentOrder.clientPhone} onChange={(e) => setCurrentOrder({...currentOrder, clientPhone: e.target.value})} className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="+880..." />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Service Type</label>
                                            <select value={currentOrder.serviceType} onChange={(e) => setCurrentOrder({...currentOrder, serviceType: e.target.value})} className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                                <option value="Corporate Video">Corporate Video</option>
                                                <option value="Product Promo">Product Promo</option>
                                                <option value="Social Media Ads">Social Media Ads</option>
                                                <option value="Training Videos">Training Videos</option>
                                                <option value="Property Showcase">Property Showcase</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Price</label>
                                            <input type="number" value={currentOrder.price} onChange={(e) => setCurrentOrder({...currentOrder, price: parseFloat(e.target.value) || 0})} className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Currency</label>
                                            <select value={currentOrder.currency} onChange={(e) => setCurrentOrder({...currentOrder, currency: e.target.value})} className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                                <option value="BDT">BDT</option>
                                                <option value="USD">USD</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Team Budget</label>
                                            <input type="number" value={currentOrder.teamBudget || 0} onChange={(e) => setCurrentOrder({...currentOrder, teamBudget: parseFloat(e.target.value) || 0})} className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Due Date</label>
                                            <input type="date" value={currentOrder.dueDate} onChange={(e) => setCurrentOrder({...currentOrder, dueDate: e.target.value})} className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Assigned Editor</label>
                                            <select value={currentOrder.assignedEditor || ''} onChange={(e) => setCurrentOrder({...currentOrder, assignedEditor: e.target.value})} className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                                <option value="">Unassigned</option>
                                                {team.filter(m => m.active).map(member => (
                                                    <option key={member.id} value={member.id}>{member.name}</option>
                                                ))}
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Status</label>
                                            <select value={currentOrder.status} onChange={(e) => setCurrentOrder({...currentOrder, status: e.target.value})} className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                                <option value="Fresh">Fresh</option>
                                                <option value="Scripting">Scripting</option>
                                                <option value="Editing">Editing</option>
                                                <option value="Correction">Correction</option>
                                                <option value="Final Delivery">Final Delivery</option>
                                                <option value="Completed">Completed</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Payment Status</label>
                                            <select value={currentOrder.paymentStatus} onChange={(e) => setCurrentOrder({...currentOrder, paymentStatus: e.target.value})} className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                                <option value="Pending">Pending</option>
                                                <option value="Partial">Partial</option>
                                                <option value="Paid">Paid</option>
                                            </select>
                                        </div>
                                        <div className="md:col-span-2">
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Notes</label>
                                            <textarea value={currentOrder.notes || ''} onChange={(e) => setCurrentOrder({...currentOrder, notes: e.target.value})} rows="3" className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Additional notes..."></textarea>
                                        </div>
                                    </div>
                                </div>
                                <div className="p-4 md:p-6 border-t border-gray-200 flex flex-col-reverse sm:flex-row justify-end gap-2 sm:space-x-3">
                                    <button onClick={() => setShowOrderModal(false)} className="w-full sm:w-auto px-4 py-2 bg-white border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50">Cancel</button>
                                    <button 
                                        onClick={handleSaveOrder} 
                                        disabled={isSaving}
                                        className={`w-full sm:w-auto px-4 py-2 rounded-lg font-medium flex items-center justify-center ${isSaving ? 'bg-blue-400 cursor-not-allowed' : 'bg-blue-600 hover:bg-blue-700'} text-white`}
                                    >
                                        {isSaving ? (<><i className="fas fa-spinner fa-spin mr-2"></i>Saving...</>) : 'Save Order'}
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* ==================== CONTACT MODAL ==================== */}
                    {showContactModal && currentContact && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-3 md:p-4 z-50">
                            <div className="bg-white rounded-xl shadow-card w-full max-w-md modal-content">
                                <div className="p-4 md:p-6 border-b border-gray-200">
                                    <div className="flex justify-between items-center">
                                        <h3 className="text-lg font-semibold text-gray-900">{currentContact.id ? 'Edit Contact' : 'Add New Contact'}</h3>
                                        <button onClick={() => setShowContactModal(false)} className="text-gray-400 hover:text-gray-600">
                                            <i className="fas fa-times text-xl"></i>
                                        </button>
                                    </div>
                                </div>
                                <div className="p-4 md:p-6 space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Name *</label>
                                        <input type="text" value={currentContact.name} onChange={(e) => setCurrentContact({...currentContact, name: e.target.value})} className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Contact name" />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Phone *</label>
                                        <input type="text" value={currentContact.phone} onChange={(e) => setCurrentContact({...currentContact, phone: e.target.value})} className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="+880..." />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Email</label>
                                        <input type="email" value={currentContact.email || ''} onChange={(e) => setCurrentContact({...currentContact, email: e.target.value})} className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="email@example.com" />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Type</label>
                                        <select value={currentContact.type} onChange={(e) => setCurrentContact({...currentContact, type: e.target.value})} className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                            <option value="Client">Client</option>
                                            <option value="Team">Team</option>
                                            <option value="Vendor">Vendor</option>
                                        </select>
                                    </div>
                                </div>
                                <div className="p-4 md:p-6 border-t border-gray-200 flex flex-col-reverse sm:flex-row justify-end gap-2 sm:space-x-3">
                                    <button onClick={() => setShowContactModal(false)} className="w-full sm:w-auto px-4 py-2 bg-white border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50">Cancel</button>
                                    <button 
                                        onClick={handleSaveContact} 
                                        disabled={isSaving}
                                        className={`w-full sm:w-auto px-4 py-2 rounded-lg font-medium flex items-center justify-center ${isSaving ? 'bg-blue-400 cursor-not-allowed' : 'bg-blue-600 hover:bg-blue-700'} text-white`}
                                    >
                                        {isSaving ? (<><i className="fas fa-spinner fa-spin mr-2"></i>Saving...</>) : 'Save Contact'}
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* ==================== TEAM MEMBER MODAL ==================== */}
                    {showTeamModal && currentTeamMember && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-3 md:p-4 z-50">
                            <div className="bg-white rounded-xl shadow-card w-full max-w-md modal-content">
                                <div className="p-4 md:p-6 border-b border-gray-200">
                                    <div className="flex justify-between items-center">
                                        <h3 className="text-lg font-semibold text-gray-900">{team.find(m => m.id === currentTeamMember.id) ? 'Edit Team Member' : 'Add Team Member'}</h3>
                                        <button onClick={() => setShowTeamModal(false)} className="text-gray-400 hover:text-gray-600">
                                            <i className="fas fa-times text-xl"></i>
                                        </button>
                                    </div>
                                </div>
                                <div className="p-4 md:p-6 space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Name *</label>
                                        <input type="text" value={currentTeamMember.name} onChange={(e) => setCurrentTeamMember({...currentTeamMember, name: e.target.value})} className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Team member name" />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Email *</label>
                                        <input type="email" value={currentTeamMember.email} onChange={(e) => setCurrentTeamMember({...currentTeamMember, email: e.target.value})} className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="email@example.com" />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Phone</label>
                                        <input type="text" value={currentTeamMember.phone || ''} onChange={(e) => setCurrentTeamMember({...currentTeamMember, phone: e.target.value})} className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="+880..." />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Role</label>
                                        <select value={currentTeamMember.role} onChange={(e) => setCurrentTeamMember({...currentTeamMember, role: e.target.value})} className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                            <option value="Video Editor">Video Editor</option>
                                            <option value="Script Writer">Script Writer</option>
                                            <option value="Motion Designer">Motion Designer</option>
                                            <option value="Project Manager">Project Manager</option>
                                        </select>
                                    </div>
                                    <div className="flex items-center pt-2">
                                        <input type="checkbox" id="active" checked={currentTeamMember.active} onChange={(e) => setCurrentTeamMember({...currentTeamMember, active: e.target.checked})} className="rounded border-gray-300 text-blue-600 focus:ring-blue-500" />
                                        <label htmlFor="active" className="ml-2 text-sm text-gray-700">Active Team Member</label>
                                    </div>
                                </div>
                                <div className="p-4 md:p-6 border-t border-gray-200 flex flex-col-reverse sm:flex-row justify-end gap-2 sm:space-x-3">
                                    <button onClick={() => setShowTeamModal(false)} className="w-full sm:w-auto px-4 py-2 bg-white border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50">Cancel</button>
                                    <button 
                                        onClick={handleSaveTeamMember} 
                                        disabled={isSaving}
                                        className={`w-full sm:w-auto px-4 py-2 rounded-lg font-medium flex items-center justify-center ${isSaving ? 'bg-blue-400 cursor-not-allowed' : 'bg-blue-600 hover:bg-blue-700'} text-white`}
                                    >
                                        {isSaving ? (<><i className="fas fa-spinner fa-spin mr-2"></i>Saving...</>) : 'Save Member'}
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* ==================== PAYMENT MODAL ==================== */}
                    {showPaymentModal && currentOrder && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-3 md:p-4 z-50">
                            <div className="bg-white rounded-xl shadow-card w-full max-w-md modal-content">
                                <div className="p-4 md:p-6 border-b border-gray-200">
                                    <div className="flex justify-between items-center">
                                        <div>
                                            <h3 className="text-lg font-semibold text-gray-900">Add Payment</h3>
                                            <p className="text-sm text-gray-500">{currentOrder.id} - {currentOrder.clientName}</p>
                                        </div>
                                        <button onClick={() => setShowPaymentModal(false)} className="text-gray-400 hover:text-gray-600">
                                            <i className="fas fa-times text-xl"></i>
                                        </button>
                                    </div>
                                </div>
                                <div className="p-4 md:p-6">
                                    <div className="bg-gray-50 rounded-lg p-3 mb-4">
                                        <div className="flex justify-between text-sm">
                                            <span className="text-gray-600">Total Amount:</span>
                                            <span className="font-medium">{formatCurrency(currentOrder.price, currentOrder.currency)}</span>
                                        </div>
                                        <div className="flex justify-between text-sm mt-1">
                                            <span className="text-gray-600">Already Paid:</span>
                                            <span className="font-medium text-green-600">{formatCurrency(currentOrder.paidAmount || 0, currentOrder.currency)}</span>
                                        </div>
                                        <div className="flex justify-between text-sm mt-1 pt-2 border-t">
                                            <span className="text-gray-600">Remaining:</span>
                                            <span className="font-bold text-red-600">{formatCurrency((currentOrder.price || 0) - (currentOrder.paidAmount || 0), currentOrder.currency)}</span>
                                        </div>
                                    </div>
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Amount *</label>
                                            <input type="number" value={currentOrder.paymentAmount || ''} onChange={(e) => setCurrentOrder({...currentOrder, paymentAmount: parseFloat(e.target.value) || 0})} className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Enter amount" />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Date *</label>
                                            <input type="date" value={currentOrder.paymentDate} onChange={(e) => setCurrentOrder({...currentOrder, paymentDate: e.target.value})} className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Method *</label>
                                            <select value={currentOrder.paymentMethod || ''} onChange={(e) => setCurrentOrder({...currentOrder, paymentMethod: e.target.value})} className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                                <option value="">Select Method</option>
                                                <option value="Cash">Cash</option>
                                                <option value="Bank Transfer">Bank Transfer</option>
                                                <option value="bKash">bKash</option>
                                                <option value="Nagad">Nagad</option>
                                                <option value="Card">Card</option>
                                                <option value="Other">Other</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Note</label>
                                            <textarea value={currentOrder.paymentNote || ''} onChange={(e) => setCurrentOrder({...currentOrder, paymentNote: e.target.value})} rows="2" className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Optional note..."></textarea>
                                        </div>
                                    </div>
                                </div>
                                <div className="p-4 md:p-6 border-t border-gray-200 flex flex-col-reverse sm:flex-row justify-end gap-2 sm:space-x-3">
                                    <button onClick={() => setShowPaymentModal(false)} className="w-full sm:w-auto px-4 py-2 bg-white border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50">Cancel</button>
                                    <button 
                                        onClick={() => handleSavePayment({ amount: currentOrder.paymentAmount, date: currentOrder.paymentDate, method: currentOrder.paymentMethod, note: currentOrder.paymentNote })} 
                                        disabled={isSaving}
                                        className={`w-full sm:w-auto px-4 py-2 rounded-lg font-medium flex items-center justify-center ${isSaving ? 'bg-green-400 cursor-not-allowed' : 'bg-green-600 hover:bg-green-700'} text-white`}
                                    >
                                        {isSaving ? (<><i className="fas fa-spinner fa-spin mr-2"></i>Recording...</>) : 'Record Payment'}
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* ==================== ANNOUNCEMENT MODAL ==================== */}
                    {showAnnouncementModal && currentAnnouncement && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-3 md:p-4 z-50">
                            <div className="bg-white rounded-xl shadow-card w-full max-w-lg modal-content">
                                <div className="p-4 md:p-6 border-b border-gray-200">
                                    <div className="flex justify-between items-center">
                                        <h3 className="text-lg font-semibold text-gray-900">{currentAnnouncement.id ? 'Edit Announcement' : 'New Announcement'}</h3>
                                        <button onClick={() => setShowAnnouncementModal(false)} className="text-gray-400 hover:text-gray-600">
                                            <i className="fas fa-times text-xl"></i>
                                        </button>
                                    </div>
                                </div>
                                <div className="p-4 md:p-6 space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Title *</label>
                                        <input type="text" value={currentAnnouncement.title} onChange={(e) => setCurrentAnnouncement({...currentAnnouncement, title: e.target.value})} className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Announcement title" />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Content *</label>
                                        <textarea value={currentAnnouncement.content} onChange={(e) => setCurrentAnnouncement({...currentAnnouncement, content: e.target.value})} rows="4" className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Write your announcement..."></textarea>
                                    </div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Category</label>
                                            <select value={currentAnnouncement.category} onChange={(e) => setCurrentAnnouncement({...currentAnnouncement, category: e.target.value})} className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                                <option value="general">General</option>
                                                <option value="target">Target</option>
                                                <option value="mission">Mission</option>
                                                <option value="dream">Dream</option>
                                                <option value="reminder">Reminder</option>
                                                <option value="idea">Idea</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Color</label>
                                            <select value={currentAnnouncement.color} onChange={(e) => setCurrentAnnouncement({...currentAnnouncement, color: e.target.value})} className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                                <option value="yellow">Yellow</option>
                                                <option value="blue">Blue</option>
                                                <option value="green">Green</option>
                                                <option value="pink">Pink</option>
                                                <option value="purple">Purple</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Priority</label>
                                            <select value={currentAnnouncement.priority} onChange={(e) => setCurrentAnnouncement({...currentAnnouncement, priority: e.target.value})} className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                                <option value="low">Low</option>
                                                <option value="medium">Medium</option>
                                                <option value="high">High</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Date</label>
                                            <input type="date" value={currentAnnouncement.createdAt} onChange={(e) => setCurrentAnnouncement({...currentAnnouncement, createdAt: e.target.value})} className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" />
                                        </div>
                                    </div>
                                </div>
                                <div className="p-4 md:p-6 border-t border-gray-200 flex flex-col-reverse sm:flex-row justify-end gap-2 sm:space-x-3">
                                    <button onClick={() => setShowAnnouncementModal(false)} className="w-full sm:w-auto px-4 py-2 bg-white border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50">Cancel</button>
                                    <button 
                                        onClick={handleSaveAnnouncement} 
                                        disabled={isSaving}
                                        className={`w-full sm:w-auto px-4 py-2 rounded-lg font-medium flex items-center justify-center ${isSaving ? 'bg-blue-400 cursor-not-allowed' : 'bg-blue-600 hover:bg-blue-700'} text-white`}
                                    >
                                        {isSaving ? (<><i className="fas fa-spinner fa-spin mr-2"></i>Saving...</>) : 'Save Announcement'}
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* ==================== TEAM BUDGET MODAL ==================== */}
                    {showBudgetModal && currentOrder && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-3 md:p-4 z-50">
                            <div className="bg-white rounded-xl shadow-card w-full max-w-md modal-content">
                                <div className="p-4 md:p-6 border-b border-gray-200">
                                    <div className="flex justify-between items-center">
                                        <div>
                                            <h3 className="text-lg font-semibold text-gray-900">Set Team Budget</h3>
                                            <p className="text-sm text-gray-500">{currentOrder.id} - {currentOrder.clientName}</p>
                                        </div>
                                        <button onClick={() => setShowBudgetModal(false)} className="text-gray-400 hover:text-gray-600">
                                            <i className="fas fa-times text-xl"></i>
                                        </button>
                                    </div>
                                </div>
                                <div className="p-4 md:p-6">
                                    <div className="bg-gray-50 rounded-lg p-3 mb-4">
                                        <div className="flex justify-between text-sm">
                                            <span className="text-gray-600">Order Total:</span>
                                            <span className="font-medium">{formatCurrency(currentOrder.price, currentOrder.currency)}</span>
                                        </div>
                                        {currentOrder.assignedEditor && (
                                            <div className="flex justify-between text-sm mt-1">
                                                <span className="text-gray-600">Assigned To:</span>
                                                <span className="font-medium">{getTeamMemberById(currentOrder.assignedEditor, team).name}</span>
                                            </div>
                                        )}
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Team Budget Amount ({currentOrder.currency})</label>
                                        <input 
                                            type="number" 
                                            value={currentOrder.teamBudget || 0} 
                                            onChange={(e) => setCurrentOrder({...currentOrder, teamBudget: parseFloat(e.target.value) || 0})} 
                                            className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" 
                                            placeholder="Enter budget amount"
                                        />
                                        <p className="text-xs text-gray-500 mt-2">
                                            <i className="fas fa-info-circle mr-1"></i>
                                            This amount will be allocated to the assigned team member's budget for this project.
                                        </p>
                                    </div>
                                </div>
                                <div className="p-4 md:p-6 border-t border-gray-200 flex flex-col-reverse sm:flex-row justify-end gap-2 sm:space-x-3">
                                    <button onClick={() => setShowBudgetModal(false)} className="w-full sm:w-auto px-4 py-2 bg-white border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50">Cancel</button>
                                    <button 
                                        onClick={handleSaveTeamBudget} 
                                        disabled={isSaving}
                                        className={`w-full sm:w-auto px-4 py-2 rounded-lg font-medium flex items-center justify-center ${isSaving ? 'bg-blue-400 cursor-not-allowed' : 'bg-blue-600 hover:bg-blue-700'} text-white`}
                                    >
                                        {isSaving ? (<><i className="fas fa-spinner fa-spin mr-2"></i>Saving...</>) : 'Save Budget'}
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* ==================== CHANGE PASSWORD MODAL ==================== */}
                    {showChangePasswordModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-3 md:p-4 z-50">
                            <div className="bg-white rounded-xl shadow-card w-full max-w-md modal-content">
                                <div className="p-4 md:p-6 border-b border-gray-200">
                                    <div className="flex justify-between items-center">
                                        <div>
                                            <h3 className="text-lg font-semibold text-gray-900">Change Password</h3>
                                            <p className="text-sm text-gray-500">Update your account password</p>
                                        </div>
                                        <button onClick={() => {
                                            setShowChangePasswordModal(false);
                                            setPasswordChange({ currentPassword: '', newPassword: '', confirmPassword: '' });
                                        }} className="text-gray-400 hover:text-gray-600">
                                            <i className="fas fa-times text-xl"></i>
                                        </button>
                                    </div>
                                </div>
                                <div className="p-4 md:p-6 space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Current Password *</label>
                                        <input 
                                            type="password" 
                                            value={passwordChange.currentPassword} 
                                            onChange={(e) => setPasswordChange({...passwordChange, currentPassword: e.target.value})} 
                                            className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" 
                                            placeholder="Enter current password"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">New Password *</label>
                                        <input 
                                            type="password" 
                                            value={passwordChange.newPassword} 
                                            onChange={(e) => setPasswordChange({...passwordChange, newPassword: e.target.value})} 
                                            className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" 
                                            placeholder="Enter new password (min 6 characters)"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Confirm New Password *</label>
                                        <input 
                                            type="password" 
                                            value={passwordChange.confirmPassword} 
                                            onChange={(e) => setPasswordChange({...passwordChange, confirmPassword: e.target.value})} 
                                            className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" 
                                            placeholder="Confirm new password"
                                        />
                                    </div>
                                    
                                    {/* Validation Messages */}
                                    {passwordChange.newPassword && passwordChange.newPassword.length < 6 && (
                                        <p className="text-sm text-yellow-600 flex items-center">
                                            <i className="fas fa-exclamation-triangle mr-2"></i>
                                            Password must be at least 6 characters
                                        </p>
                                    )}
                                    {passwordChange.newPassword && passwordChange.confirmPassword && passwordChange.newPassword !== passwordChange.confirmPassword && (
                                        <p className="text-sm text-red-600 flex items-center">
                                            <i className="fas fa-times-circle mr-2"></i>
                                            Passwords do not match
                                        </p>
                                    )}
                                    {passwordChange.newPassword && passwordChange.confirmPassword && passwordChange.newPassword === passwordChange.confirmPassword && passwordChange.newPassword.length >= 6 && (
                                        <p className="text-sm text-green-600 flex items-center">
                                            <i className="fas fa-check-circle mr-2"></i>
                                            Passwords match
                                        </p>
                                    )}
                                </div>
                                <div className="p-4 md:p-6 border-t border-gray-200 flex flex-col-reverse sm:flex-row justify-end gap-2 sm:space-x-3">
                                    <button 
                                        onClick={() => {
                                            setShowChangePasswordModal(false);
                                            setPasswordChange({ currentPassword: '', newPassword: '', confirmPassword: '' });
                                        }} 
                                        className="w-full sm:w-auto px-4 py-2 bg-white border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50"
                                    >
                                        Cancel
                                    </button>
                                    <button 
                                        onClick={handleChangePassword}
                                        disabled={isSaving || !passwordChange.currentPassword || !passwordChange.newPassword || !passwordChange.confirmPassword || passwordChange.newPassword !== passwordChange.confirmPassword || passwordChange.newPassword.length < 6}
                                        className={`w-full sm:w-auto px-4 py-2 rounded-lg font-medium flex items-center justify-center ${
                                            isSaving || !passwordChange.currentPassword || !passwordChange.newPassword || !passwordChange.confirmPassword || passwordChange.newPassword !== passwordChange.confirmPassword || passwordChange.newPassword.length < 6
                                                ? 'bg-gray-300 text-gray-500 cursor-not-allowed'
                                                : 'bg-blue-600 text-white hover:bg-blue-700'
                                        }`}
                                    >
                                        {isSaving ? (<><i className="fas fa-spinner fa-spin mr-2"></i>Updating...</>) : (<><i className="fas fa-key mr-2"></i>Update Password</>)}
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                                                           {/* ==================== ADMIN MODAL (FULLY RESPONSIVE) ==================== */}
                    {showAdminModal && currentAdmin && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-2 sm:p-3 md:p-4 z-50">
                            <div className="bg-white rounded-xl sm:rounded-2xl shadow-2xl w-full max-w-[95%] sm:max-w-md md:max-w-lg modal-content overflow-hidden">
                                {/* Header - Responsive */}
                                <div className="p-3 sm:p-4 md:p-5 border-b border-gray-100 bg-gradient-to-r from-blue-600 to-purple-600">
                                    <div className="flex justify-between items-center">
                                        <div className="text-white">
                                            <h3 className="text-base sm:text-lg md:text-xl font-bold flex items-center">
                                                <i className={`fas ${currentAdmin.isEditing ? 'fa-user-edit' : 'fa-user-plus'} mr-2 text-sm sm:text-base`}></i>
                                                {currentAdmin.isEditing ? 'Edit Admin' : 'Create New Admin'}
                                            </h3>
                                            <p className="text-blue-100 text-xs sm:text-sm mt-0.5 sm:mt-1">
                                                {currentAdmin.isEditing ? 'Update admin information' : 'Add a new admin to dashboard'}
                                            </p>
                                        </div>
                                        <button 
                                            onClick={() => {
                                                setShowAdminModal(false);
                                                setCurrentAdmin(null);
                                            }} 
                                            className="text-white/80 hover:text-white hover:bg-white/20 rounded-full p-1.5 sm:p-2 transition-all"
                                        >
                                            <i className="fas fa-times text-lg sm:text-xl"></i>
                                        </button>
                                    </div>
                                </div>

                                {/* Form Body - Responsive */}
                                <div className="p-3 sm:p-4 md:p-5 space-y-3 sm:space-y-4 max-h-[60vh] sm:max-h-[65vh] overflow-y-auto">
                                    {/* Name Field */}
                                    <div>
                                        <label className="block text-xs sm:text-sm font-semibold text-gray-700 mb-1 sm:mb-1.5">
                                            <i className="fas fa-user mr-1 text-gray-400"></i> Full Name *
                                        </label>
                                        <input 
                                            type="text" 
                                            value={currentAdmin.name} 
                                            onChange={(e) => setCurrentAdmin({...currentAdmin, name: e.target.value})} 
                                            className="w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" 
                                            placeholder="Enter full name" 
                                        />
                                    </div>

                                    {/* Email Field */}
                                    <div>
                                        <label className="block text-xs sm:text-sm font-semibold text-gray-700 mb-1 sm:mb-1.5">
                                            <i className="fas fa-envelope mr-1 text-gray-400"></i> Email Address *
                                        </label>
                                        <input 
                                            type="email" 
                                            value={currentAdmin.email} 
                                            onChange={(e) => setCurrentAdmin({...currentAdmin, email: e.target.value})} 
                                            className={`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all ${currentAdmin.isEditing ? 'bg-gray-100 cursor-not-allowed' : ''}`}
                                            placeholder="admin@example.com"
                                            disabled={currentAdmin.isEditing}
                                        />
                                        {currentAdmin.isEditing && (
                                            <p className="text-xs text-gray-500 mt-1">
                                                <i className="fas fa-lock mr-1"></i> Email cannot be changed
                                            </p>
                                        )}
                                    </div>
                                    
                                    {/* Password Field - Only for NEW admin */}
                                    {!currentAdmin.isEditing && (
                                        <div>
                                            <label className="block text-xs sm:text-sm font-semibold text-gray-700 mb-1 sm:mb-1.5">
                                                <i className="fas fa-lock mr-1 text-gray-400"></i> Password *
                                            </label>
                                            <div className="relative">
                                                <input 
                                                    type={currentAdmin.showPassword ? "text" : "password"}
                                                    value={currentAdmin.password || ''} 
                                                    onChange={(e) => setCurrentAdmin({...currentAdmin, password: e.target.value})} 
                                                    className="w-full px-3 sm:px-4 py-2 sm:py-2.5 pr-20 sm:pr-24 text-sm border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" 
                                                    placeholder="Min 6 characters"
                                                />
                                                <div className="absolute inset-y-0 right-0 flex items-center">
                                                    <button
                                                        type="button"
                                                        onClick={() => setCurrentAdmin({...currentAdmin, showPassword: !currentAdmin.showPassword})}
                                                        className="px-1.5 sm:px-2 text-gray-400 hover:text-gray-600"
                                                    >
                                                        <i className={`fas ${currentAdmin.showPassword ? 'fa-eye-slash' : 'fa-eye'} text-sm`}></i>
                                                    </button>
                                                    <button
                                                        type="button"
                                                        onClick={() => {
                                                            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz23456789';
                                                            let pass = '';
                                                            for (let i = 0; i < 10; i++) {
                                                                pass += chars.charAt(Math.floor(Math.random() * chars.length));
                                                            }
                                                            setCurrentAdmin({...currentAdmin, password: pass, showPassword: true});
                                                        }}
                                                        className="px-2 sm:px-3 py-0.5 sm:py-1 mr-1 sm:mr-2 text-xs bg-blue-100 text-blue-600 rounded-md sm:rounded-lg hover:bg-blue-200 font-medium"
                                                    >
                                                        <span className="hidden xs:inline">Generate</span>
                                                        <i className="fas fa-magic xs:hidden"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            {currentAdmin.password && currentAdmin.password.length > 0 && currentAdmin.password.length < 6 && (
                                                <p className="text-xs text-red-500 mt-1 flex items-center">
                                                    <i className="fas fa-exclamation-circle mr-1"></i>
                                                    Min 6 characters required
                                                </p>
                                            )}
                                            {currentAdmin.password && currentAdmin.password.length >= 6 && (
                                                <p className="text-xs text-green-500 mt-1 flex items-center">
                                                    <i className="fas fa-check-circle mr-1"></i>
                                                    Password is valid
                                                </p>
                                            )}
                                        </div>
                                    )}

                                    {/* Role & Status - 2 Column on larger screens */}
                                    <div className="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
                                        {/* Role Field */}
                                        <div>
                                            <label className="block text-xs sm:text-sm font-semibold text-gray-700 mb-1 sm:mb-1.5">
                                                <i className="fas fa-user-tag mr-1 text-gray-400"></i> Role
                                            </label>
                                            <select 
                                                value={currentAdmin.role} 
                                                onChange={(e) => setCurrentAdmin({...currentAdmin, role: e.target.value})} 
                                                className="w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"
                                            >
                                                <option value="Admin">Admin</option>
                                                <option value="Super Admin">Super Admin</option>
                                                <option value="Moderator">Moderator</option>
                                            </select>
                                        </div>

                                        {/* Status Field */}
                                        <div>
                                            <label className="block text-xs sm:text-sm font-semibold text-gray-700 mb-1 sm:mb-1.5">
                                                <i className="fas fa-toggle-on mr-1 text-gray-400"></i> Status
                                            </label>
                                            <select 
                                                value={currentAdmin.status} 
                                                onChange={(e) => setCurrentAdmin({...currentAdmin, status: e.target.value})} 
                                                className="w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"
                                            >
                                                <option value="active"> Active</option>
                                                <option value="blocked"> Blocked</option>
                                            </select>
                                        </div>
                                    </div>

                                    {/* Info Box for New Admin */}
                                    {!currentAdmin.isEditing && (
                                        <div className="bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200 rounded-lg sm:rounded-xl p-3 sm:p-4">
                                            <h4 className="text-xs sm:text-sm font-bold text-blue-800 flex items-center mb-1.5 sm:mb-2">
                                                <i className="fas fa-info-circle mr-1.5 sm:mr-2"></i>
                                                How it works
                                            </h4>
                                            <ul className="text-xs text-blue-700 space-y-1 sm:space-y-1.5">
                                                <li className="flex items-start">
                                                    <i className="fas fa-check text-green-500 mr-1.5 sm:mr-2 mt-0.5 text-xs"></i>
                                                    <span>Firebase account created automatically</span>
                                                </li>
                                                <li className="flex items-start">
                                                    <i className="fas fa-check text-green-500 mr-1.5 sm:mr-2 mt-0.5 text-xs"></i>
                                                    <span>Share credentials with new admin</span>
                                                </li>
                                                <li className="flex items-start">
                                                    <i className="fas fa-check text-green-500 mr-1.5 sm:mr-2 mt-0.5 text-xs"></i>
                                                    <span>They can change password after login</span>
                                                </li>
                                                <li className="flex items-start">
                                                    <i className="fas fa-check text-green-500 mr-1.5 sm:mr-2 mt-0.5 text-xs"></i>
                                                    <span>Block or remove them anytime</span>
                                                </li>
                                            </ul>
                                        </div>
                                    )}
                                </div>

                                {/* Footer - Responsive */}
                                <div className="p-3 sm:p-4 md:p-5 border-t border-gray-100 bg-gray-50 flex flex-col-reverse sm:flex-row justify-end gap-2 sm:gap-3">
                                    <button 
                                        onClick={() => {
                                            setShowAdminModal(false);
                                            setCurrentAdmin(null);
                                        }} 
                                        className="w-full sm:w-auto px-4 sm:px-5 py-2 sm:py-2.5 bg-white border-2 border-gray-200 rounded-lg sm:rounded-xl text-gray-700 font-medium hover:bg-gray-50 transition-all text-sm"
                                    >
                                        Cancel
                                    </button>
                                    <button 
                                        onClick={handleSaveAdmin} 
                                        disabled={isSaving || (!currentAdmin.isEditing && (!currentAdmin.password || currentAdmin.password.length < 6)) || !currentAdmin.name || !currentAdmin.email}
                                        className={`w-full sm:w-auto px-4 sm:px-5 py-2 sm:py-2.5 rounded-lg sm:rounded-xl font-medium flex items-center justify-center transition-all text-sm ${
                                            isSaving || (!currentAdmin.isEditing && (!currentAdmin.password || currentAdmin.password.length < 6)) || !currentAdmin.name || !currentAdmin.email
                                                ? 'bg-gray-200 text-gray-400 cursor-not-allowed' 
                                                : 'bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white shadow-lg hover:shadow-xl'
                                        }`}
                                    >
                                        {isSaving ? (
                                            <><i className="fas fa-spinner fa-spin mr-1.5 sm:mr-2"></i><span className="hidden xs:inline">Processing...</span><span className="xs:hidden">Wait...</span></>
                                        ) : currentAdmin.isEditing ? (
                                            <><i className="fas fa-save mr-1.5 sm:mr-2"></i>Save Changes</>
                                        ) : (
                                            <><i className="fas fa-user-plus mr-1.5 sm:mr-2"></i>Create Admin</>
                                        )}
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* ==================== TEAM PAYMENT MODAL ==================== */}
                    {showTeamPaymentModal && currentOrder && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                            <div className="bg-white rounded-xl shadow-card w-full max-w-sm modal-content transform transition-all">
                                <div className="p-4 border-b border-gray-100 flex justify-between items-center bg-gray-50 rounded-t-xl">
                                    <div>
                                        <h3 className="text-lg font-bold text-gray-900">Team Payment</h3>
                                        <p className="text-xs text-gray-500 mt-1">Project: {currentOrder.id}</p>
                                    </div>
                                    <button onClick={() => setShowTeamPaymentModal(false)} className="text-gray-400 hover:text-red-500 transition-colors">
                                        <i className="fas fa-times text-xl"></i>
                                    </button>
                                </div>
                                
                                <div className="p-5 space-y-5">
                                    <div className="bg-blue-50 p-4 rounded-xl border border-blue-100">
                                        <div className="flex justify-between text-sm mb-2">
                                            <span className="text-blue-600">Total Budget:</span>
                                            <span className="font-bold text-gray-800">{formatCurrency(currentOrder.teamBudget || 0, currentOrder.currency)}</span>
                                        </div>
                                        <div className="flex justify-between text-sm mb-2">
                                            <span className="text-blue-600">Already Paid:</span>
                                            <span className="font-bold text-green-600">{formatCurrency(currentOrder.teamPaidAmount || 0, currentOrder.currency)}</span>
                                        </div>
                                        <div className="border-t border-blue-200 mt-2 pt-2 flex justify-between text-sm">
                                            <span className="font-bold text-blue-800">Remaining Due:</span>
                                            <span className="font-bold text-red-500">{formatCurrency((currentOrder.teamBudget || 0) - (currentOrder.teamPaidAmount || 0), currentOrder.currency)}</span>
                                        </div>
                                    </div>

                                    <div>
                                        <label className="block text-sm font-semibold text-gray-700 mb-2">Payment Amount</label>
                                        <div className="relative">
                                            <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                                <span className="text-gray-500 sm:text-sm">{currentOrder.currency === 'USD' ? '$' : ''}</span>
                                            </div>
                                            <input 
                                                type="number" 
                                                value={currentOrder.teamPaidAmount || ''} 
                                                onChange={(e) => setCurrentOrder({...currentOrder, teamPaidAmount: e.target.value})}
                                                className="w-full pl-8 pr-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all text-gray-900 font-medium"
                                                placeholder="Enter custom amount"
                                            />
                                        </div>
                                    </div>

                                    <div className="grid grid-cols-2 gap-3 pt-2">
                                        <button 
                                            onClick={() => handleSaveTeamPayment(currentOrder.teamPaidAmount, false)}
                                            disabled={isSaving}
                                            className="w-full py-3 bg-white border-2 border-blue-600 text-blue-600 rounded-xl font-bold hover:bg-blue-50 transition-colors"
                                        >
                                            {isSaving ? <i className="fas fa-spinner fa-spin"></i> : 'Save Custom'}
                                        </button>
                                        <button 
                                            onClick={() => handleSaveTeamPayment(0, true)}
                                            disabled={isSaving}
                                            className="w-full py-3 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 shadow-lg shadow-blue-200 transition-all flex justify-center items-center"
                                        >
                                            {isSaving ? <i className="fas fa-spinner fa-spin"></i> : <><i className="fas fa-check-circle mr-2"></i>Full Paid</>}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                    
                                                          {/* ==================== ACTIVITY LOG MODAL (DETAILED + NO DELETE) ==================== */}
                    {showActivityLogModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-2 sm:p-4 z-50">
                            <div className="bg-white rounded-xl shadow-2xl w-full max-w-5xl max-h-[95vh] overflow-hidden">
                                {/* Header */}
                                <div className="p-4 md:p-6 border-b border-gray-200 bg-gradient-to-r from-orange-500 to-red-500">
                                    <div className="flex justify-between items-center">
                                        <div className="text-white">
                                            <h3 className="text-lg md:text-xl font-bold flex items-center">
                                                <i className="fas fa-history mr-2"></i>
                                                Admin Activity History
                                            </h3>
                                            <p className="text-orange-100 text-xs md:text-sm mt-1">
                                                Complete immutable log of all actions  Cannot be deleted
                                            </p>
                                        </div>
                                        <button 
                                            onClick={() => setShowActivityLogModal(false)} 
                                            className="text-white/80 hover:text-white hover:bg-white/20 rounded-full p-2"
                                        >
                                            <i className="fas fa-times text-xl"></i>
                                        </button>
                                    </div>
                                </div>

                                {/* Stats Bar */}
                                <div className="px-4 md:px-6 py-3 bg-gray-50 border-b border-gray-200 flex flex-wrap gap-4">
                                    <div className="flex items-center text-sm">
                                        <i className="fas fa-list text-blue-500 mr-2"></i>
                                        <span className="text-gray-600">Total:</span>
                                        <span className="font-bold text-gray-900 ml-1">{activityLogs.length}</span>
                                    </div>
                                    <div className="flex items-center text-sm">
                                        <i className="fas fa-lock text-red-500 mr-2"></i>
                                        <span className="text-gray-600">Status:</span>
                                        <span className="font-bold text-red-600 ml-1">Immutable</span>
                                    </div>
                                </div>

                                {/* Activity List */}
                                <div className="overflow-y-auto max-h-[calc(95vh-200px)]">
                                    {activityLogs.length === 0 ? (
                                        <div className="p-12 text-center">
                                            <i className="fas fa-clipboard-list text-5xl text-gray-300 mb-4"></i>
                                            <p className="text-gray-500 text-lg">No activity recorded yet</p>
                                        </div>
                                    ) : (
                                        <div className="divide-y divide-gray-100">
                                            {activityLogs.map((log, index) => (
                                                <div key={log.id} className="px-4 md:px-6 py-4 hover:bg-gray-50 transition-colors">
                                                    <div className="flex items-start gap-3 md:gap-4">
                                                        {/* Index Number */}
                                                        <div className="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center text-gray-600 text-xs font-bold flex-shrink-0">
                                                            {activityLogs.length - index}
                                                        </div>
                                                        
                                                        {/* Action Icon */}
                                                        <div className={`w-10 h-10 rounded-full flex items-center justify-center text-white flex-shrink-0 ${
                                                            log.action.includes('DELETE') ? 'bg-red-500' :
                                                            log.action.includes('BLOCK') ? 'bg-yellow-500' :
                                                            log.action.includes('UNBLOCK') ? 'bg-green-500' :
                                                            log.action.includes('LOGIN') ? 'bg-blue-600' :
                                                            log.action.includes('LOGOUT') ? 'bg-gray-500' :
                                                            log.action.includes('CREATE') || log.action.includes('ADD') ? 'bg-green-500' :
                                                            log.action.includes('PAYMENT') ? 'bg-purple-500' :
                                                            log.action.includes('STATUS') ? 'bg-blue-500' :
                                                            log.action.includes('BUDGET') ? 'bg-indigo-500' :
                                                            log.action.includes('EDITOR') || log.action.includes('ASSIGN') ? 'bg-cyan-500' :
                                                            'bg-gray-500'
                                                        }`}>
                                                            <i className={`fas ${
                                                                log.action.includes('DELETE') ? 'fa-trash' :
                                                                log.action.includes('BLOCK') ? 'fa-ban' :
                                                                log.action.includes('UNBLOCK') ? 'fa-unlock' :
                                                                log.action.includes('LOGIN') ? 'fa-sign-in-alt' :
                                                                log.action.includes('LOGOUT') ? 'fa-sign-out-alt' :
                                                                log.action.includes('CREATE') || log.action.includes('ADD') ? 'fa-plus' :
                                                                log.action.includes('PAYMENT') ? 'fa-money-bill' :
                                                                log.action.includes('STATUS') ? 'fa-sync' :
                                                                log.action.includes('BUDGET') ? 'fa-coins' :
                                                                log.action.includes('EDITOR') || log.action.includes('ASSIGN') ? 'fa-user-check' :
                                                                log.action.includes('ORDER') ? 'fa-clipboard-list' :
                                                                log.action.includes('TEAM') ? 'fa-users' :
                                                                log.action.includes('CONTACT') ? 'fa-address-book' :
                                                                log.action.includes('ADMIN') ? 'fa-user-shield' :
                                                                log.action.includes('ANNOUNCEMENT') ? 'fa-bullhorn' :
                                                                'fa-edit'
                                                            } text-sm`}></i>
                                                        </div>
                                                        
                                                        {/* Details */}
                                                        <div className="flex-1 min-w-0">
                                                            <p className="text-sm md:text-base font-medium text-gray-900 break-words">
                                                                {log.details}
                                                            </p>
                                                            <div className="flex items-center gap-2 mt-2 flex-wrap">
                                                                {/* Action Badge */}
                                                                <span className={`px-2 py-0.5 text-xs rounded-full font-medium ${
                                                                    log.action.includes('DELETE') ? 'bg-red-100 text-red-800' :
                                                                    log.action.includes('BLOCK') ? 'bg-yellow-100 text-yellow-800' :
                                                                    log.action.includes('LOGIN') ? 'bg-blue-100 text-blue-800' :
                                                                    log.action.includes('LOGOUT') ? 'bg-gray-100 text-gray-800' :
                                                                    log.action.includes('CREATE') || log.action.includes('ADD') ? 'bg-green-100 text-green-800' :
                                                                    log.action.includes('PAYMENT') ? 'bg-purple-100 text-purple-800' :
                                                                    'bg-blue-100 text-blue-800'
                                                                }`}>
                                                                    {log.action.replace(/_/g, ' ')}
                                                                </span>
                                                                
                                                                {/* Performed By */}
                                                                <span className="text-xs text-gray-500 flex items-center">
                                                                    <i className="fas fa-user mr-1"></i>
                                                                    {log.performedBy?.name || log.performedBy?.email}
                                                                </span>
                                                                
                                                                {/* Platform (if available) */}
                                                                {log.platform && (
                                                                    <span className="text-xs text-gray-400 flex items-center">
                                                                        <i className="fas fa-desktop mr-1"></i>
                                                                        {log.platform.includes('Win') ? 'Windows' : 
                                                                         log.platform.includes('Mac') ? 'Mac' : 
                                                                         log.platform.includes('Linux') ? 'Linux' : 
                                                                         log.platform.includes('Android') ? 'Android' :
                                                                         log.platform.includes('iPhone') ? 'iPhone' : 'Unknown'}
                                                                    </span>
                                                                )}
                                                            </div>
                                                            
                                                            {/* Show detailed changes if available */}
                                                            {log.extraData?.changes && log.extraData.changes.length > 0 && (
                                                                <div className="mt-2 p-2 bg-gray-50 rounded-lg text-xs">
                                                                    <p className="font-semibold text-gray-700 mb-1">Changes:</p>
                                                                    {log.extraData.changes.map((change, idx) => (
                                                                        <div key={idx} className="text-gray-600">
                                                                            <span className="font-medium">{change.field}:</span>{' '}
                                                                            <span className="text-red-600 line-through">"{change.oldValue || 'empty'}"</span>{'  '}
                                                                            <span className="text-green-600">"{change.newValue}"</span>
                                                                        </div>
                                                                    ))}
                                                                </div>
                                                            )}
                                                        </div>
                                                        
                                                        {/* Timestamp */}
                                                        <div className="text-right flex-shrink-0">
                                                            <p className="text-xs md:text-sm font-medium text-gray-600">{log.date}</p>
                                                            <p className="text-xs text-gray-400">{log.time}</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>

                                {/* Footer */}
                                <div className="p-4 border-t border-gray-200 bg-gray-50 flex flex-col sm:flex-row justify-between items-center gap-3">
                                    <div className="flex items-center text-sm text-gray-500">
                                        <i className="fas fa-shield-alt text-green-500 mr-2"></i>
                                        <span>This log is permanent and cannot be modified or deleted</span>
                                    </div>
                                    <button 
                                        onClick={() => setShowActivityLogModal(false)} 
                                        className="w-full sm:w-auto px-6 py-2 bg-gray-600 text-white rounded-lg font-medium hover:bg-gray-700"
                                    >
                                        Close
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Click outside to close user menu */}
                    {showUserMenu && (
                        <div 
                            className="fixed inset-0 z-30" 
                            onClick={() => setShowUserMenu(false)}
                        ></div>
                    )}

                    {/* Click outside to close user menu */}
                    {showUserMenu && (
                        <div 
                            className="fixed inset-0 z-30" 
                            onClick={() => setShowUserMenu(false)}
                        ></div>
                    )}
                </div>
            );
        };

        // =============================================
        // RENDER THE DASHBOARD
        // =============================================
        ReactDOM.render(<Dashboard />, document.getElementById('root'));
    </script>
</body>
</html>